
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>hydpy.core.sequencetools &#8212; HydPy 4.0a11 documentation</title>
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HydPy 4.0a11 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for hydpy.core.sequencetools</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;This module implements tools for defining and handling different kinds</span>
<span class="sd">of the sequences (time series) of hydrological models.&quot;&quot;&quot;</span>
<span class="c1"># import...</span>
<span class="c1"># ...from standard library</span>
<span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">runpy</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">Any</span><span class="p">,</span> <span class="n">ClassVar</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">IO</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span>
    <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">Union</span><span class="p">)</span>
<span class="c1"># ...from site-packages</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="c1"># ...from HydPy</span>
<span class="kn">import</span> <span class="nn">hydpy</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="k">import</span> <span class="n">objecttools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="k">import</span> <span class="n">propertytools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="k">import</span> <span class="n">variabletools</span>
<span class="kn">from</span> <span class="nn">hydpy.cythons.autogen</span> <span class="k">import</span> <span class="n">pointerutils</span>
<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="k">import</span> <span class="n">devicetools</span>
    <span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="k">import</span> <span class="n">modeltools</span>
    <span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="k">import</span> <span class="n">timetools</span>
    <span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="k">import</span> <span class="n">typingtools</span>


<div class="viewcode-block" id="InfoArray"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.InfoArray">[docs]</a><span class="k">class</span> <span class="nc">InfoArray</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;|numpy| |numpy.ndarray| subclass that stores and tries to keep</span>
<span class="sd">    an additional `info` attribute.</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.core.sequencetools import InfoArray</span>
<span class="sd">    &gt;&gt;&gt; array = InfoArray([1.0, 2.0], info=&#39;this array is short&#39;)</span>
<span class="sd">    &gt;&gt;&gt; array</span>
<span class="sd">    InfoArray([ 1.,  2.])</span>
<span class="sd">    &gt;&gt;&gt; array.info</span>
<span class="sd">    &#39;this array is short&#39;</span>
<span class="sd">    &gt;&gt;&gt; subarray = array[:1]</span>
<span class="sd">    &gt;&gt;&gt; subarray</span>
<span class="sd">    InfoArray([ 1.])</span>
<span class="sd">    &gt;&gt;&gt; subarray.info</span>
<span class="sd">    &#39;this array is short&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">info</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="nf">__array_finalize__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="s1">&#39;InfoArray&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="Sequences"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.Sequences">[docs]</a><span class="k">class</span> <span class="nc">Sequences</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Base class for handling all sequences of a specific model.</span>

<span class="sd">    |Sequences| objects handle nine sequence subgroups as attributes</span>
<span class="sd">    such as the `inlets` and  the `receivers` subsequences:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.examples import prepare_full_example_2</span>
<span class="sd">    &gt;&gt;&gt; hp, pub, TestIO = prepare_full_example_2()</span>
<span class="sd">    &gt;&gt;&gt; sequences = hp.elements.land_dill.model.sequences</span>
<span class="sd">    &gt;&gt;&gt; bool(sequences.inlets)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; bool(sequences.fluxes)</span>
<span class="sd">    True</span>

<span class="sd">    Iteration makes only the non-empty subgroups available which</span>
<span class="sd">    are handling |Sequence| objects:</span>

<span class="sd">    &gt;&gt;&gt; for subseqs in sequences:</span>
<span class="sd">    ...     print(subseqs.name)</span>
<span class="sd">    inputs</span>
<span class="sd">    fluxes</span>
<span class="sd">    states</span>
<span class="sd">    logs</span>
<span class="sd">    outlets</span>

<span class="sd">    Class |Sequences| provides some methods related to reading and</span>
<span class="sd">    writing time series data, which (directly or indirectly) call the</span>
<span class="sd">    corresponding methods of the handled |IOSequence| objects.</span>
<span class="sd">    In most cases, users should prefer to use the related methods of</span>
<span class="sd">    class |HydPy| but using the ones of class |Sequences| can be more</span>
<span class="sd">    convenient when analysing a specific model in-depth.</span>

<span class="sd">    To introduce these methods, we first change two IO-related settings:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">    &gt;&gt;&gt; pub.options.checkseries = False</span>
<span class="sd">    &gt;&gt;&gt; pub.sequencemanager.generaloverwrite = True</span>

<span class="sd">    Method |Sequences.activate_ram| and method |Sequences.deactivate_ram|</span>
<span class="sd">    enables/disables handling time series in rapid access memory and</span>
<span class="sd">    method |Sequences.save_series| writes time series to files:</span>

<span class="sd">    &gt;&gt;&gt; sequences.activate_ram()</span>
<span class="sd">    &gt;&gt;&gt; sequences.inputs.t.ramflag</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; sequences.inputs.t.series = 1.0, 2.0, 3.0, 4.0</span>
<span class="sd">    &gt;&gt;&gt; with TestIO():</span>
<span class="sd">    ...     sequences.save_series()</span>
<span class="sd">    &gt;&gt;&gt; sequences.deactivate_ram()</span>
<span class="sd">    &gt;&gt;&gt; sequences.inputs.t.ramflag</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; sequences.inputs.t.series</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeError: Sequence `t` of element `land_dill` is not requested \</span>
<span class="sd">to make any internal data available.</span>

<span class="sd">    Method |Sequences.activate_disk| and |Sequences.deactivate_disk|</span>
<span class="sd">    enables/disables handling time series on disk and method</span>
<span class="sd">    |Sequences.load_series| reads time series from files:</span>

<span class="sd">    &gt;&gt;&gt; with TestIO():</span>
<span class="sd">    ...     sequences.activate_disk()</span>
<span class="sd">    &gt;&gt;&gt; sequences.inputs.t.diskflag</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; with TestIO():</span>
<span class="sd">    ...     sequences.load_series()</span>
<span class="sd">    ...     round_(sequences.inputs.t.series)</span>
<span class="sd">    1.0, 2.0, 3.0, 4.0</span>
<span class="sd">    &gt;&gt;&gt; with TestIO():</span>
<span class="sd">    ...     sequences.deactivate_disk()</span>
<span class="sd">    &gt;&gt;&gt; sequences.inputs.t.diskflag</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; hasattr(sequences.inputs.t, &#39;series&#39;)</span>
<span class="sd">    False</span>

<span class="sd">    Methods |Sequences.ram2disk| and |Sequences.disk2ram| allow moving</span>
<span class="sd">    data from RAM to disk and from disk to RAM, respectively:</span>

<span class="sd">    &gt;&gt;&gt; sequences.activate_ram()</span>
<span class="sd">    &gt;&gt;&gt; sequences.inputs.t.ramflag</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; sequences.inputs.t.series = 1.0, 2.0, 3.0, 4.0</span>
<span class="sd">    &gt;&gt;&gt; with TestIO():</span>
<span class="sd">    ...     sequences.ram2disk()</span>
<span class="sd">    &gt;&gt;&gt; sequences.inputs.t.diskflag</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; with TestIO():</span>
<span class="sd">    ...     round_(sequences.inputs.t.series)</span>
<span class="sd">    1.0, 2.0, 3.0, 4.0</span>
<span class="sd">    &gt;&gt;&gt; with TestIO():</span>
<span class="sd">    ...     sequences.disk2ram()</span>
<span class="sd">    &gt;&gt;&gt; round_(sequences.inputs.t.series)</span>
<span class="sd">    1.0, 2.0, 3.0, 4.0</span>

<span class="sd">    The documentation on class |IOSequence| explains the underlying</span>
<span class="sd">    functionalities of class |IOSequence| in more detail.</span>

<span class="sd">    &gt;&gt;&gt; pub.options.checkseries = True</span>
<span class="sd">    &gt;&gt;&gt; pub.sequencemanager.generaloverwrite = False</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">model</span><span class="p">:</span> <span class="s1">&#39;modeltools.Model&#39;</span>
    <span class="n">inlets</span><span class="p">:</span> <span class="s1">&#39;InletSequences&#39;</span>
    <span class="n">receivers</span><span class="p">:</span> <span class="s1">&#39;ReceiverSequences&#39;</span>
    <span class="n">inputs</span><span class="p">:</span> <span class="s1">&#39;InputSequences&#39;</span>
    <span class="n">fluxes</span><span class="p">:</span> <span class="s1">&#39;FluxSequences&#39;</span>
    <span class="n">states</span><span class="p">:</span> <span class="s1">&#39;StateSequences&#39;</span>
    <span class="n">logs</span><span class="p">:</span> <span class="s1">&#39;LogSequences&#39;</span>
    <span class="n">aides</span><span class="p">:</span> <span class="s1">&#39;AideSequences&#39;</span>
    <span class="n">outlets</span><span class="p">:</span> <span class="s1">&#39;OutputSequences&#39;</span>
    <span class="n">senders</span><span class="p">:</span> <span class="s1">&#39;SenderSequences&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">model</span><span class="p">:</span> <span class="s1">&#39;modeltools.Model&#39;</span><span class="p">,</span>
            <span class="n">cls_inlets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="s1">&#39;InletSequences&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">cls_receivers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="s1">&#39;ReceiverSequences&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">cls_inputs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="s1">&#39;InputSequences&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">cls_fluxes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="s1">&#39;FluxSequences&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">cls_states</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="s1">&#39;StateSequences&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">cls_logs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="s1">&#39;LogSequences&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">cls_aides</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="s1">&#39;AideSequences&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">cls_outlets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="s1">&#39;OutletSequences&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">cls_senders</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="s1">&#39;SenderSequences&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">cymodel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;typingtools.CyModelProtocol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">cythonmodule</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inlets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__prepare_subseqs</span><span class="p">(</span>
            <span class="s1">&#39;Inlet&#39;</span><span class="p">,</span> <span class="n">cls_inlets</span><span class="p">,</span> <span class="n">cymodel</span><span class="p">,</span> <span class="n">cythonmodule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__prepare_subseqs</span><span class="p">(</span>
            <span class="s1">&#39;Receiver&#39;</span><span class="p">,</span> <span class="n">cls_receivers</span><span class="p">,</span> <span class="n">cymodel</span><span class="p">,</span> <span class="n">cythonmodule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__prepare_subseqs</span><span class="p">(</span>
            <span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="n">cls_inputs</span><span class="p">,</span> <span class="n">cymodel</span><span class="p">,</span> <span class="n">cythonmodule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fluxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__prepare_subseqs</span><span class="p">(</span>
            <span class="s1">&#39;Flux&#39;</span><span class="p">,</span> <span class="n">cls_fluxes</span><span class="p">,</span> <span class="n">cymodel</span><span class="p">,</span> <span class="n">cythonmodule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__prepare_subseqs</span><span class="p">(</span>
            <span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="n">cls_states</span><span class="p">,</span> <span class="n">cymodel</span><span class="p">,</span> <span class="n">cythonmodule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__prepare_subseqs</span><span class="p">(</span>
            <span class="s1">&#39;Log&#39;</span><span class="p">,</span> <span class="n">cls_logs</span><span class="p">,</span> <span class="n">cymodel</span><span class="p">,</span> <span class="n">cythonmodule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aides</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__prepare_subseqs</span><span class="p">(</span>
            <span class="s1">&#39;Aide&#39;</span><span class="p">,</span> <span class="n">cls_aides</span><span class="p">,</span> <span class="n">cymodel</span><span class="p">,</span> <span class="n">cythonmodule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outlets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__prepare_subseqs</span><span class="p">(</span>
            <span class="s1">&#39;Outlet&#39;</span><span class="p">,</span> <span class="n">cls_outlets</span><span class="p">,</span> <span class="n">cymodel</span><span class="p">,</span> <span class="n">cythonmodule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">senders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__prepare_subseqs</span><span class="p">(</span>
            <span class="s1">&#39;Sender&#39;</span><span class="p">,</span> <span class="n">cls_senders</span><span class="p">,</span> <span class="n">cymodel</span><span class="p">,</span> <span class="n">cythonmodule</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__prepare_subseqs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">class_</span><span class="p">,</span> <span class="n">cymodel</span><span class="p">,</span> <span class="n">cythonmodule</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{prefix}</span><span class="s1">Sequences&#39;</span>
        <span class="k">if</span> <span class="n">class_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">class_</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="nb">globals</span><span class="p">()[</span><span class="n">name</span><span class="p">])</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">class_</span><span class="p">,</span> <span class="s1">&#39;CLASSES&#39;</span><span class="p">,</span> <span class="p">())</span>
        <span class="k">return</span> <span class="n">class_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cythonmodule</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">cymodel</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">iosubsequences</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="s1">&#39;IOSequences&#39;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Yield all relevant |IOSequences| objects handled by the current</span>
<span class="sd">        |Sequences| object.</span>

<span class="sd">        The currently available IO-subgroups are `inputs`, `fluxes`,</span>
<span class="sd">        and `states`.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model</span>
<span class="sd">        &gt;&gt;&gt; model = prepare_model(&#39;hland_v1&#39;, &#39;1d&#39;)</span>
<span class="sd">        &gt;&gt;&gt; for subseqs in model.sequences.iosubsequences:</span>
<span class="sd">        ...     print(subseqs.name)</span>
<span class="sd">        inputs</span>
<span class="sd">        fluxes</span>
<span class="sd">        states</span>

<span class="sd">        However, not all models implement sequences for all these</span>
<span class="sd">        subgroups.  Property |Sequences.iosubsequences| only yields</span>
<span class="sd">        those subgroups which are non-empty:</span>

<span class="sd">        &gt;&gt;&gt; model = prepare_model(&#39;hstream_v1&#39;, &#39;1d&#39;)</span>
<span class="sd">        &gt;&gt;&gt; for subseqs in model.sequences.iosubsequences:</span>
<span class="sd">        ...     print(subseqs.name)</span>
<span class="sd">        states</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">subseqs</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluxes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">subseqs</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">subseqs</span>

<div class="viewcode-block" id="Sequences.activate_disk"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.Sequences.activate_disk">[docs]</a>    <span class="k">def</span> <span class="nf">activate_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Call method |IOSequences.activate_disk| of all handled</span>
<span class="sd">        |IOSequences| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">subseqs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iosubsequences</span><span class="p">:</span>
            <span class="n">subseqs</span><span class="o">.</span><span class="n">activate_disk</span><span class="p">()</span></div>

<div class="viewcode-block" id="Sequences.deactivate_disk"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.Sequences.deactivate_disk">[docs]</a>    <span class="k">def</span> <span class="nf">deactivate_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Call method |IOSequences.deactivate_disk| of all handled</span>
<span class="sd">        |IOSequences| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">subseqs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iosubsequences</span><span class="p">:</span>
            <span class="n">subseqs</span><span class="o">.</span><span class="n">deactivate_disk</span><span class="p">()</span></div>

<div class="viewcode-block" id="Sequences.activate_ram"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.Sequences.activate_ram">[docs]</a>    <span class="k">def</span> <span class="nf">activate_ram</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Call method |IOSequences.activate_ram| of all handled</span>
<span class="sd">        |IOSequences| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">subseqs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iosubsequences</span><span class="p">:</span>
            <span class="n">subseqs</span><span class="o">.</span><span class="n">activate_ram</span><span class="p">()</span></div>

<div class="viewcode-block" id="Sequences.deactivate_ram"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.Sequences.deactivate_ram">[docs]</a>    <span class="k">def</span> <span class="nf">deactivate_ram</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Call method |IOSequences.deactivate_ram| of all handled</span>
<span class="sd">        |IOSequences| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">subseqs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iosubsequences</span><span class="p">:</span>
            <span class="n">subseqs</span><span class="o">.</span><span class="n">deactivate_ram</span><span class="p">()</span></div>

<div class="viewcode-block" id="Sequences.ram2disk"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.Sequences.ram2disk">[docs]</a>    <span class="k">def</span> <span class="nf">ram2disk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call method |IOSequences.ram2disk| of all handled</span>
<span class="sd">        |IOSequences| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">subseqs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iosubsequences</span><span class="p">:</span>
            <span class="n">subseqs</span><span class="o">.</span><span class="n">ram2disk</span><span class="p">()</span></div>

<div class="viewcode-block" id="Sequences.disk2ram"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.Sequences.disk2ram">[docs]</a>    <span class="k">def</span> <span class="nf">disk2ram</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call method |IOSequence.disk2ram| of all handled</span>
<span class="sd">        |IOSequences| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">subseqs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iosubsequences</span><span class="p">:</span>
            <span class="n">subseqs</span><span class="o">.</span><span class="n">disk2ram</span><span class="p">()</span></div>

<div class="viewcode-block" id="Sequences.load_series"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.Sequences.load_series">[docs]</a>    <span class="k">def</span> <span class="nf">load_series</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call method |IOSequences.load_series| of all handled</span>
<span class="sd">        |IOSequences| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">subseqs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iosubsequences</span><span class="p">:</span>
            <span class="n">subseqs</span><span class="o">.</span><span class="n">load_series</span><span class="p">()</span></div>

<div class="viewcode-block" id="Sequences.save_series"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.Sequences.save_series">[docs]</a>    <span class="k">def</span> <span class="nf">save_series</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call method |IOSequence.save_ext| of all handled</span>
<span class="sd">        |IOSequences| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">subseqs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iosubsequences</span><span class="p">:</span>
            <span class="n">subseqs</span><span class="o">.</span><span class="n">save_series</span><span class="p">()</span></div>

<div class="viewcode-block" id="Sequences.open_files"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.Sequences.open_files">[docs]</a>    <span class="k">def</span> <span class="nf">open_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Call method |IOSequences.open_files| of all handled</span>
<span class="sd">        |IOSequences| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">subseqs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iosubsequences</span><span class="p">:</span>
            <span class="n">subseqs</span><span class="o">.</span><span class="n">open_files</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequences.close_files"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.Sequences.close_files">[docs]</a>    <span class="k">def</span> <span class="nf">close_files</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Call method |IOSequences.close_files| of all handled</span>
<span class="sd">        |IOSequences| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">subseqs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iosubsequences</span><span class="p">:</span>
            <span class="n">subseqs</span><span class="o">.</span><span class="n">close_files</span><span class="p">()</span></div>

<div class="viewcode-block" id="Sequences.load_data"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.Sequences.load_data">[docs]</a>    <span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Call method |ModelIOSequences.load_data| of the handled</span>
<span class="sd">        |sequencetools.InputSequences| object.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequences.save_data"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.Sequences.save_data">[docs]</a>    <span class="k">def</span> <span class="nf">save_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Call method |ModelIOSequences.save_data| of the handled</span>
<span class="sd">        |sequencetools.FluxSequences| and |sequencetools.StateSequences|</span>
<span class="sd">        objects.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequences.reset"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.Sequences.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Call method |ConditionSequence.reset| of all handled</span>
<span class="sd">        |ConditionSequence| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">subseqs</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logs</span><span class="p">):</span>
            <span class="n">subseqs</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">conditionsequences</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> \
            <span class="n">Iterator</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="s1">&#39;StateSequences&#39;</span><span class="p">,</span> <span class="s1">&#39;LogSequences&#39;</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Generator object yielding all conditions (|StateSequence| and</span>
<span class="sd">        |LogSequence| objects).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">subseqs</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logs</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="n">subseqs</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">seq</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]]:</span>
        <span class="sd">&quot;&quot;&quot;A nested dictionary which contains the values of all condition</span>
<span class="sd">        sequences.</span>

<span class="sd">        See the documentation on property |HydPy.conditions| for further</span>
<span class="sd">        information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">conditions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditionsequences</span><span class="p">:</span>
            <span class="n">subconditions</span> <span class="o">=</span> <span class="n">conditions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">seq</span><span class="o">.</span><span class="n">subseqs</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">{})</span>
            <span class="n">subconditions</span><span class="p">[</span><span class="n">seq</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">seq</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="n">conditions</span><span class="p">[</span><span class="n">seq</span><span class="o">.</span><span class="n">subseqs</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">subconditions</span>
        <span class="k">return</span> <span class="n">conditions</span>

    <span class="nd">@conditions</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conditions</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">trimvariables</span><span class="p">(</span><span class="kc">False</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">subname</span><span class="p">,</span> <span class="n">subconditions</span> <span class="ow">in</span> <span class="n">conditions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">subseqs</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subname</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">seqname</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">subconditions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="nb">getattr</span><span class="p">(</span><span class="n">subseqs</span><span class="p">,</span> <span class="n">seqname</span><span class="p">)(</span><span class="n">values</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conditionsequences</span><span class="p">)):</span>
            <span class="n">seq</span><span class="o">.</span><span class="n">trim</span><span class="p">()</span>

<div class="viewcode-block" id="Sequences.load_conditions"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.Sequences.load_conditions">[docs]</a>    <span class="k">def</span> <span class="nf">load_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Read the initial conditions from a file and assign them to the</span>
<span class="sd">        respective |StateSequence| and |LogSequence| objects handled by</span>
<span class="sd">        the actual |Sequences| object.</span>

<span class="sd">        The documentation on method |HydPy.load_conditions| of class</span>
<span class="sd">        |HydPy| explains how to read and write condition values for</span>
<span class="sd">        complete *HydPy* projects in the most convenient manner.</span>
<span class="sd">        However, using the underlying methods |Sequences.load_conditions|</span>
<span class="sd">        and |Sequences.save_conditions| directly offers the advantage to</span>
<span class="sd">        specify alternative filenames.  We demonstrate this through</span>
<span class="sd">        using the `land_dill` |Element| object of the `LahnH` example</span>
<span class="sd">        project and focussing on the values of state sequence</span>
<span class="sd">        |hland_states.SM|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_2</span>
<span class="sd">        &gt;&gt;&gt; hp, pub, TestIO = prepare_full_example_2()</span>
<span class="sd">        &gt;&gt;&gt; sequences = hp.elements.land_dill.model.sequences</span>
<span class="sd">        &gt;&gt;&gt; sequences.states.sm</span>
<span class="sd">        sm(185.13164, 181.18755, 199.80432, 196.55888, 212.04018, 209.48859,</span>
<span class="sd">           222.12115, 220.12671, 230.30756, 228.70779, 236.91943, 235.64427)</span>

<span class="sd">        From now on, we work in the freshly created condition</span>
<span class="sd">        directory `test`:</span>

<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     pub.conditionmanager.currentdir = &#39;test&#39;</span>

<span class="sd">        We set all soil moisture values to zero and write the updated</span>
<span class="sd">        values to the file `cold_start.py`:</span>

<span class="sd">        &gt;&gt;&gt; sequences.states.sm(0.0)</span>

<span class="sd">        &gt;&gt;&gt; with TestIO():   # doctest: +ELLIPSIS</span>
<span class="sd">        ...     sequences.save_conditions(&#39;cold_start.py&#39;)</span>

<span class="sd">        Trying to reload from the written file (after changing the</span>
<span class="sd">        soil moisture values again) without passing the file name</span>
<span class="sd">        fails due to assuming the elements name as file</span>
<span class="sd">        name base:</span>

<span class="sd">        &gt;&gt;&gt; sequences.states.sm(100.0)</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():   # doctest: +ELLIPSIS</span>
<span class="sd">        ...     sequences.load_conditions()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        FileNotFoundError: While trying to load the initial conditions \</span>
<span class="sd">of element `land_dill`, the following error occurred: [Errno 2] No such \</span>
<span class="sd">file or directory: &#39;...land_dill.py&#39;</span>

<span class="sd">        One does not need to state the file extensions (`.py`)  explicitly:</span>

<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     sequences.load_conditions(&#39;cold_start&#39;)</span>
<span class="sd">        &gt;&gt;&gt; sequences.states.sm</span>
<span class="sd">        sm(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)</span>

<span class="sd">        Note that determining the file name automatically requires a</span>
<span class="sd">        proper reference to the related |Element| object:</span>

<span class="sd">        &gt;&gt;&gt; del sequences.model.element</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     sequences.save_conditions()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: While trying to save the actual conditions of \</span>
<span class="sd">element `?`, the following error occurred: To load or save the conditions \</span>
<span class="sd">of a model from or to a file, its filename must be known.  This can be \</span>
<span class="sd">done, by passing filename to method `load_conditions` or `save_conditions` \</span>
<span class="sd">directly.  But in complete HydPy applications, it is usally assumed to be \</span>
<span class="sd">consistent with the name of the element handling the model.  Actually, \</span>
<span class="sd">neither a filename is given nor does the model know its master element.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">logs</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dict_</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditionsequences</span><span class="p">:</span>
                    <span class="n">dict_</span><span class="p">[</span><span class="n">seq</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">seq</span>
                <span class="n">dict_</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
                <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">conditionmanager</span><span class="o">.</span><span class="n">inputpath</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__prepare_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
                <span class="n">runpy</span><span class="o">.</span><span class="n">run_path</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">init_globals</span><span class="o">=</span><span class="n">dict_</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                    <span class="n">f</span><span class="s1">&#39;While trying to load the initial conditions of &#39;</span>
                    <span class="n">f</span><span class="s1">&#39;element `{objecttools.devicename(self)}`&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequences.save_conditions"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.Sequences.save_conditions">[docs]</a>    <span class="k">def</span> <span class="nf">save_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Query the actual conditions of the |StateSequence| and</span>
<span class="sd">        |LogSequence| objects handled by the actual |Sequences| object</span>
<span class="sd">        and write them into an initial condition file.</span>

<span class="sd">        See the documentation on method |Sequences.load_conditions| for</span>
<span class="sd">        further information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">logs</span><span class="p">:</span>
                <span class="n">con</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">controlmanager</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">f</span><span class="s1">&#39;# -*- coding: utf-8 -*-</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="n">f</span><span class="s1">&#39;from hydpy.models.</span><span class="si">{self.model}</span><span class="s1"> import *</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="n">f</span><span class="s1">&#39;controlcheck(projectdir=&quot;</span><span class="si">{con.projectdir}</span><span class="s1">&quot;, &#39;</span>
                    <span class="n">f</span><span class="s1">&#39;controldir=&quot;</span><span class="si">{con.currentdir}</span><span class="s1">&quot;, &#39;</span>
                    <span class="n">f</span><span class="s1">&#39;stepsize=&quot;</span><span class="si">{hydpy.pub.timegrids.stepsize}</span><span class="s1">&quot;)</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditionsequences</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">conditionmanager</span><span class="o">.</span><span class="n">outputpath</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__prepare_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_</span><span class="p">:</span>
                    <span class="n">file_</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;While trying to save the actual conditions of &#39;</span>
                <span class="n">f</span><span class="s1">&#39;element `{objecttools.devicename(self)}`&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__prepare_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">devicename</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s1">&#39;?&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s1">&#39;To load or save the conditions of a model from or to a &#39;</span>
                    <span class="s1">&#39;file, its filename must be known.  This can be done, &#39;</span>
                    <span class="s1">&#39;by passing filename to method `load_conditions` or &#39;</span>
                    <span class="s1">&#39;`save_conditions` directly.  But in complete HydPy &#39;</span>
                    <span class="s1">&#39;applications, it is usally assumed to be consistent &#39;</span>
                    <span class="s1">&#39;with the name of the element handling the model. &#39;</span>
                    <span class="s1">&#39; Actually, neither a filename is given nor does the &#39;</span>
                    <span class="s1">&#39;model know its master element.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.py&#39;</span><span class="p">):</span>
            <span class="n">filename</span> <span class="o">+=</span> <span class="s1">&#39;.py&#39;</span>
        <span class="k">return</span> <span class="n">filename</span>

<div class="viewcode-block" id="Sequences.trim_conditions"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.Sequences.trim_conditions">[docs]</a>    <span class="k">def</span> <span class="nf">trim_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Call method |trim| of each handled |ConditionSequence|.</span>

<span class="sd">        |Sequences.trim_conditions| is just a convenience function for</span>
<span class="sd">        calling method |trim| of all |StateSequence| and |LogSequence|</span>
<span class="sd">        objects returned by property |Sequences.conditionsequences|.</span>
<span class="sd">        We demonstrate its functionality by preparing an instance of</span>
<span class="sd">        application model |lland_v1|, using its available default</span>
<span class="sd">        values, and defining out-of-bound values of the soil moisture</span>
<span class="sd">        state sequence |lland_states.BoWa|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model, pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &#39;2000-01-01&#39;, &#39;2000-01-10&#39;, &#39;1d&#39;</span>
<span class="sd">        &gt;&gt;&gt; with pub.options.usedefaultvalues(True):</span>
<span class="sd">        ...     model = prepare_model(&#39;lland_v1&#39;, &#39;1d&#39;)</span>
<span class="sd">        ...     model.parameters.control.nhru(2)</span>
<span class="sd">        &gt;&gt;&gt; model.sequences.states.bowa = -100.0</span>
<span class="sd">        &gt;&gt;&gt; model.sequences.trim_conditions()</span>
<span class="sd">        &gt;&gt;&gt; model.sequences.states.bowa</span>
<span class="sd">        bowa(0.0, 0.0)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditionsequences</span><span class="p">:</span>
            <span class="n">seq</span><span class="o">.</span><span class="n">trim</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="s1">&#39;SubSequences&#39;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">subseqs</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inlets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">fluxes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logs</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">aides</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">outlets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">senders</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">subseqs</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">subseqs</span>

    <span class="k">def</span> <span class="nf">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model</span>
<span class="sd">        &gt;&gt;&gt; model = prepare_model(&#39;hland_v1&#39;, &#39;1d&#39;)</span>
<span class="sd">        &gt;&gt;&gt; dir(model.sequences)</span>
<span class="sd">        [&#39;activate_disk&#39;, &#39;activate_ram&#39;, &#39;aides&#39;, &#39;close_files&#39;, \</span>
<span class="sd">&#39;conditions&#39;, &#39;conditionsequences&#39;, &#39;deactivate_disk&#39;, &#39;deactivate_ram&#39;, \</span>
<span class="sd">&#39;disk2ram&#39;, &#39;fluxes&#39;, &#39;inlets&#39;, &#39;inputs&#39;, &#39;iosubsequences&#39;, \</span>
<span class="sd">&#39;load_conditions&#39;, &#39;load_data&#39;, &#39;load_series&#39;, &#39;logs&#39;, &#39;model&#39;, \</span>
<span class="sd">&#39;open_files&#39;, &#39;outlets&#39;, &#39;ram2disk&#39;, &#39;receivers&#39;, &#39;reset&#39;, \</span>
<span class="sd">&#39;save_conditions&#39;, &#39;save_data&#39;, &#39;save_series&#39;, &#39;senders&#39;, &#39;states&#39;, \</span>
<span class="sd">&#39;trim_conditions&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">dir_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="SubSequences"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.SubSequences">[docs]</a><span class="k">class</span> <span class="nc">SubSequences</span><span class="p">(</span><span class="n">variabletools</span><span class="o">.</span><span class="n">SubVariables</span><span class="p">[</span><span class="n">Sequences</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Base class for handling subgroups of sequences.</span>

<span class="sd">    Each |SubSequences| object has a `fastaccess` attribute.  When</span>
<span class="sd">    working in pure Python mode, this is an instance either of class</span>
<span class="sd">    |FastAccessModelSequence| of class |FastAccessNodeSequence|:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import classname, prepare_model, pub</span>
<span class="sd">    &gt;&gt;&gt; with pub.options.usecython(False):</span>
<span class="sd">    ...     model = prepare_model(&#39;lland_v1&#39;)</span>
<span class="sd">    &gt;&gt;&gt; classname(model.sequences.inputs.fastaccess)</span>
<span class="sd">    &#39;FastAccessModelSequence&#39;</span>

<span class="sd">    When working in Cython mode (which is the default mode and much</span>
<span class="sd">    faster), `fastaccess` is an object of a Cython extension class</span>
<span class="sd">    specialised for the respective model and sequence group:</span>

<span class="sd">    &gt;&gt;&gt; with pub.options.usecython(True):</span>
<span class="sd">    ...     model = prepare_model(&#39;lland_v1&#39;)</span>
<span class="sd">    &gt;&gt;&gt; classname(model.sequences.inputs.fastaccess)</span>
<span class="sd">    &#39;InputSequences&#39;</span>

<span class="sd">    See the documentation of similar class |SubParameters| for further</span>
<span class="sd">    information.  However, note the difference that model developers</span>
<span class="sd">    should not subclass |SubSequences| directly but specialised subclasses</span>
<span class="sd">    like |sequencetools.FluxSequences| or |sequencetools.StateSequences|</span>
<span class="sd">    instead.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The class name in lower case letters omitting the last</span>
<span class="sd">        eight characters (&quot;equences&quot;).</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.sequencetools import ModelSequences</span>
<span class="sd">        &gt;&gt;&gt; class StateSequences(ModelSequences):</span>
<span class="sd">        ...     CLASSES = ()</span>
<span class="sd">        &gt;&gt;&gt; StateSequences(None).name</span>
<span class="sd">        &#39;states&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">instancename</span><span class="p">(</span><span class="bp">self</span><span class="p">)[:</span><span class="o">-</span><span class="mi">8</span><span class="p">]</span></div>


<div class="viewcode-block" id="ModelSequences"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.ModelSequences">[docs]</a><span class="k">class</span> <span class="nc">ModelSequences</span><span class="p">(</span><span class="n">SubSequences</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for handling model-related subgroups of sequences.&quot;&quot;&quot;</span>

    <span class="n">seqs</span><span class="p">:</span> <span class="n">Sequences</span>
    <span class="n">fastaccess</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="s1">&#39;FastAccessSequence&#39;</span><span class="p">,</span> <span class="s1">&#39;typingtools.FastAccessModelSequenceProtocol&#39;</span><span class="p">]</span>
    <span class="n">_cls_fastaccess</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span>
        <span class="s1">&#39;typingtools.FastAccessModelSequenceProtocol&#39;</span><span class="p">]]</span>
    <span class="n">_cymodel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;typingtools.CyModelProtocol&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">master</span><span class="p">:</span> <span class="n">Sequences</span><span class="p">,</span>
            <span class="n">cls_fastaccess</span><span class="p">:</span>
            <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span>
                <span class="s1">&#39;typingtools.FastAccessModelSequenceProtocol&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">cymodel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;typingtools.CyModelProtocol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seqs</span> <span class="o">=</span> <span class="n">master</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cls_fastaccess</span> <span class="o">=</span> <span class="n">cls_fastaccess</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cymodel</span> <span class="o">=</span> <span class="n">cymodel</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">master</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__hydpy__initialise_fastaccess__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cls_fastaccess</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cymodel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span> <span class="o">=</span> <span class="n">FastAccessModelSequence</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cls_fastaccess</span><span class="p">()</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cymodel</span><span class="o">.</span><span class="n">sequences</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">)</span></div>


<div class="viewcode-block" id="IOSequences"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.IOSequences">[docs]</a><span class="k">class</span> <span class="nc">IOSequences</span><span class="p">(</span><span class="n">SubSequences</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Subclass of |SubSequences|, specialised for handling |IOSequence|</span>
<span class="sd">    objects.&quot;&quot;&quot;</span>

    <span class="n">fastaccess</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="s1">&#39;FastAccessSequence&#39;</span><span class="p">,</span> <span class="s1">&#39;typingtools.FastAccessModelSequenceProtocol&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="IOSequences.activate_ram"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.IOSequences.activate_ram">[docs]</a>    <span class="k">def</span> <span class="nf">activate_ram</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call method |IOSequence.activate_ram| of all handled</span>
<span class="sd">        |IOSequence| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">seq</span><span class="o">.</span><span class="n">activate_ram</span><span class="p">()</span></div>

<div class="viewcode-block" id="IOSequences.deactivate_ram"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.IOSequences.deactivate_ram">[docs]</a>    <span class="k">def</span> <span class="nf">deactivate_ram</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call method |IOSequence.deactivate_ram| of all handled</span>
<span class="sd">        |IOSequence| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">seq</span><span class="o">.</span><span class="n">deactivate_ram</span><span class="p">()</span></div>

<div class="viewcode-block" id="IOSequences.activate_disk"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.IOSequences.activate_disk">[docs]</a>    <span class="k">def</span> <span class="nf">activate_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call method |IOSequence.activate_disk| of all handled</span>
<span class="sd">        |IOSequence| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">seq</span><span class="o">.</span><span class="n">activate_disk</span><span class="p">()</span></div>

<div class="viewcode-block" id="IOSequences.deactivate_disk"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.IOSequences.deactivate_disk">[docs]</a>    <span class="k">def</span> <span class="nf">deactivate_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call method |IOSequence.deactivate_disk| of all handled</span>
<span class="sd">        |IOSequence| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">seq</span><span class="o">.</span><span class="n">deactivate_disk</span><span class="p">()</span></div>

<div class="viewcode-block" id="IOSequences.ram2disk"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.IOSequences.ram2disk">[docs]</a>    <span class="k">def</span> <span class="nf">ram2disk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call method |IOSequence.ram2disk| of all handled</span>
<span class="sd">        |IOSequence| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">seq</span><span class="o">.</span><span class="n">ram2disk</span><span class="p">()</span></div>

<div class="viewcode-block" id="IOSequences.disk2ram"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.IOSequences.disk2ram">[docs]</a>    <span class="k">def</span> <span class="nf">disk2ram</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call method |IOSequence.disk2ram| of all handled</span>
<span class="sd">        |IOSequence| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">seq</span><span class="o">.</span><span class="n">disk2ram</span><span class="p">()</span></div>

<div class="viewcode-block" id="IOSequences.load_series"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.IOSequences.load_series">[docs]</a>    <span class="k">def</span> <span class="nf">load_series</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call method |IOSequence.load_ext| of all handled</span>
<span class="sd">        |IOSequence| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">seq</span><span class="o">.</span><span class="n">memoryflag</span><span class="p">:</span>
                <span class="n">seq</span><span class="o">.</span><span class="n">load_ext</span><span class="p">()</span></div>

<div class="viewcode-block" id="IOSequences.save_series"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.IOSequences.save_series">[docs]</a>    <span class="k">def</span> <span class="nf">save_series</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call method |IOSequence.save_ext| of all handled</span>
<span class="sd">        |IOSequence| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">seq</span><span class="o">.</span><span class="n">memoryflag</span><span class="p">:</span>
                <span class="n">seq</span><span class="o">.</span><span class="n">save_ext</span><span class="p">()</span></div>

<div class="viewcode-block" id="IOSequences.open_files"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.IOSequences.open_files">[docs]</a>    <span class="k">def</span> <span class="nf">open_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Call method |FastAccessSequence.open_files| of the</span>
<span class="sd">        |FastAccessSequence| object handled as attribute `fastaccess`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="o">.</span><span class="n">open_files</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></div>

<div class="viewcode-block" id="IOSequences.close_files"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.IOSequences.close_files">[docs]</a>    <span class="k">def</span> <span class="nf">close_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call method |FastAccessSequence.close_files| of the</span>
<span class="sd">        |FastAccessSequence| object handled as attribute `fastaccess`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="o">.</span><span class="n">close_files</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="ModelIOSequences"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.ModelIOSequences">[docs]</a><span class="k">class</span> <span class="nc">ModelIOSequences</span><span class="p">(</span><span class="n">IOSequences</span><span class="p">,</span> <span class="n">ModelSequences</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for handling model-related subgroups of |IOSequence| objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fastaccess</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s1">&#39;FastAccessModelSequence&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;typingtools.FastAccessModelSequenceProtocol&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="ModelIOSequences.load_data"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.ModelIOSequences.load_data">[docs]</a>    <span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Call method |FastAccessModelSequence.load_data| of the</span>
<span class="sd">        |FastAccessModelSequence| object handled as attribute `fastaccess`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></div>

<div class="viewcode-block" id="ModelIOSequences.save_data"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.ModelIOSequences.save_data">[docs]</a>    <span class="k">def</span> <span class="nf">save_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Call method |FastAccessModelSequence.save_data| of the</span>
<span class="sd">        |FastAccessModelSequence| object handled as attribute `fastaccess`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="InputSequences"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.InputSequences">[docs]</a><span class="k">class</span> <span class="nc">InputSequences</span><span class="p">(</span><span class="n">ModelIOSequences</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for handling |InputSequence| objects.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="FluxSequences"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.FluxSequences">[docs]</a><span class="k">class</span> <span class="nc">FluxSequences</span><span class="p">(</span><span class="n">ModelIOSequences</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for handling |FluxSequence| objects.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Always return the string &quot;fluxes&quot;.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;fluxes&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">numericsequences</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="s1">&#39;FluxSequence&#39;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Iterator for `numerical` flux sequences.</span>

<span class="sd">        `numerical` means that the `NUMERIC` class attribute of the</span>
<span class="sd">        actual sequence is `True`:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model</span>
<span class="sd">        &gt;&gt;&gt; model = prepare_model(&#39;dam_v001&#39;)</span>
<span class="sd">        &gt;&gt;&gt; len(model.sequences.fluxes)</span>
<span class="sd">        11</span>
<span class="sd">        &gt;&gt;&gt; for seq in model.sequences.fluxes.numericsequences:</span>
<span class="sd">        ...     print(seq)</span>
<span class="sd">        inflow(nan)</span>
<span class="sd">        actualrelease(nan)</span>
<span class="sd">        flooddischarge(nan)</span>
<span class="sd">        outflow(nan)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">flux</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">flux</span><span class="o">.</span><span class="n">NUMERIC</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">flux</span></div>


<div class="viewcode-block" id="StateSequences"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.StateSequences">[docs]</a><span class="k">class</span> <span class="nc">StateSequences</span><span class="p">(</span><span class="n">ModelIOSequences</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for handling |StateSequence| objects.&quot;&quot;&quot;</span>

    <span class="n">fastaccess_new</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s1">&#39;FastAccessModelSequence&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;typingtools.FastAccessModelSequenceProtocol&#39;</span><span class="p">]</span>
    <span class="n">fastaccess_old</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s1">&#39;FastAccessModelSequence&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;typingtools.FastAccessModelSequenceProtocol&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__hydpy__initialise_fastaccess__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__hydpy__initialise_fastaccess__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cls_fastaccess</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cymodel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess_old</span> <span class="o">=</span> <span class="n">FastAccessModelSequence</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cymodel</span><span class="o">.</span><span class="n">sequences</span><span class="p">,</span> <span class="s1">&#39;new_states&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess_old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cls_fastaccess</span><span class="p">()</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cymodel</span><span class="o">.</span><span class="n">sequences</span><span class="p">,</span> <span class="s1">&#39;old_states&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess_old</span><span class="p">)</span>

<div class="viewcode-block" id="StateSequences.new2old"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.StateSequences.new2old">[docs]</a>    <span class="k">def</span> <span class="nf">new2old</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Call method |StateSequence.new2old| of all handled</span>
<span class="sd">        |StateSequence| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">seq</span><span class="o">.</span><span class="n">new2old</span><span class="p">()</span></div>

<div class="viewcode-block" id="StateSequences.reset"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.StateSequences.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Call method |ConditionSequence.reset| of all handled</span>
<span class="sd">        |StateSequence| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">seq</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="LogSequences"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.LogSequences">[docs]</a><span class="k">class</span> <span class="nc">LogSequences</span><span class="p">(</span><span class="n">ModelSequences</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for handling |LogSequence| objects.&quot;&quot;&quot;</span>

    <span class="n">fastaccess</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s1">&#39;FastAccessModelSequence&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;typingtools.FastAccessModelSequenceProtocol&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="LogSequences.reset"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.LogSequences.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Call method |ConditionSequence.reset| of all handled</span>
<span class="sd">        |LogSequence| objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">seq</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="AideSequences"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.AideSequences">[docs]</a><span class="k">class</span> <span class="nc">AideSequences</span><span class="p">(</span><span class="n">ModelSequences</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for handling |AideSequence| objects.&quot;&quot;&quot;</span>

    <span class="n">fastaccess</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s1">&#39;FastAccessModelSequence&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;typingtools.FastAccessModelSequenceProtocol&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="LinkSequences"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.LinkSequences">[docs]</a><span class="k">class</span> <span class="nc">LinkSequences</span><span class="p">(</span><span class="n">ModelSequences</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for handling |LinkSequence| objects.&quot;&quot;&quot;</span>

    <span class="n">fastaccess</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s1">&#39;FastAccessModelSequence&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;typingtools.FastAccessLinkSequenceProtocol&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="InletSequences"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.InletSequences">[docs]</a><span class="k">class</span> <span class="nc">InletSequences</span><span class="p">(</span><span class="n">LinkSequences</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for handling &quot;inlet&quot; |LinkSequence| objects.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="OutletSequences"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.OutletSequences">[docs]</a><span class="k">class</span> <span class="nc">OutletSequences</span><span class="p">(</span><span class="n">LinkSequences</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for handling &quot;outlet&quot; |LinkSequence| objects.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="ReceiverSequences"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.ReceiverSequences">[docs]</a><span class="k">class</span> <span class="nc">ReceiverSequences</span><span class="p">(</span><span class="n">LinkSequences</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for handling &quot;receiver&quot; |LinkSequence| objects.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="SenderSequences"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.SenderSequences">[docs]</a><span class="k">class</span> <span class="nc">SenderSequences</span><span class="p">(</span><span class="n">LinkSequences</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for handling &quot;sender&quot; |LinkSequence| objects.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="Sequence"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.Sequence">[docs]</a><span class="k">class</span> <span class="nc">Sequence</span><span class="p">(</span><span class="n">variabletools</span><span class="o">.</span><span class="n">Variable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for defining different kinds of sequences.</span>

<span class="sd">    Note that model developers should not derive their model-specific</span>
<span class="sd">    sequence classes from |Sequence| directly but from the &quot;final&quot;</span>
<span class="sd">    subclasses provided in module |sequencetools| (e.g. |FluxSequence|).</span>

<span class="sd">    From the model developer perspective and especially from the</span>
<span class="sd">    user perspective, |Sequence| is only a small extension of its base</span>
<span class="sd">    class |Variable|.  One relevant extension is that (only the) 0-dimensional</span>
<span class="sd">    sequence objects come with a predefined shape:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import prepare_model</span>
<span class="sd">    &gt;&gt;&gt; model = prepare_model(&#39;lland_v1&#39;, &#39;1d&#39;)</span>
<span class="sd">    &gt;&gt;&gt; model.sequences.aides.epw.shape</span>
<span class="sd">    ()</span>
<span class="sd">    &gt;&gt;&gt; sfa = model.sequences.aides.sfa</span>
<span class="sd">    &gt;&gt;&gt; sfa.shape</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeError: Shape information for variable `sfa` can only be \</span>
<span class="sd">retrieved after it has been defined.</span>

<span class="sd">    For high numbers of entries, the string representation puts the</span>
<span class="sd">    names of the constants within a list (to make the string representations</span>
<span class="sd">    executable under Python 3.6; this behaviour changes as soon</span>
<span class="sd">    as Python 3.7 becomes the oldest supported version):</span>

<span class="sd">    &gt;&gt;&gt; sfa.shape = (255,)</span>
<span class="sd">    &gt;&gt;&gt; sfa    # doctest: +ELLIPSIS</span>
<span class="sd">    sfa(nan, nan, ..., nan, nan)</span>
<span class="sd">    &gt;&gt;&gt; sfa.shape = (256,)</span>
<span class="sd">    &gt;&gt;&gt; sfa    # doctest: +ELLIPSIS</span>
<span class="sd">    sfa([nan, nan, ..., nan, nan])</span>

<span class="sd">    For consistency with the usage of |Parameter| subclasses, |Sequence|</span>
<span class="sd">    objects are also &quot;callable&quot; for setting their values (but in a much</span>
<span class="sd">    less and flexible manner):</span>

<span class="sd">    &gt;&gt;&gt; sfa(2.0)</span>
<span class="sd">    &gt;&gt;&gt; sfa    # doctest: +ELLIPSIS</span>
<span class="sd">    sfa([2.0, 2.0, ..., 2.0, 2.0])</span>

<span class="sd">    Under the hood, class |Sequence| also prepares some attributes</span>
<span class="sd">    of its class |FastAccessSequence| object, used for performing</span>
<span class="sd">    the actual simulation calculations.   Framework developers should</span>
<span class="sd">    note that the respective `fastaccess` attributes contain both</span>
<span class="sd">    the name of the sequence and the name of the original attribute</span>
<span class="sd">    in lower case letters.  We take `NDIM` as an example:</span>

<span class="sd">    &gt;&gt;&gt; sfa.fastaccess._sfa_ndim</span>
<span class="sd">    1</span>

<span class="sd">    Some of these attributes require updating under some situations.</span>
<span class="sd">    For example, other sequences than |AideSequence| objects require</span>
<span class="sd">    a &quot;length&quot; attribute, which needs to be updated each time the</span>
<span class="sd">    sequence&#39;s shape changes:</span>

<span class="sd">    &gt;&gt;&gt; sfa.fastaccess._sfa_length</span>
<span class="sd">    0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">TYPE</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span>
    <span class="n">INIT</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">NUMERIC</span><span class="p">:</span> <span class="nb">bool</span>

    <span class="n">strict_valuehandling</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">fastaccess</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s1">&#39;FastAccessModelSequence&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;typingtools.FastAccessModelSequenceProtocol&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">subseqs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Alias for attribute `subvars`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subvars</span>

    <span class="k">def</span> <span class="nf">__hydpy__connect_variable2subgroup__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subvars</span><span class="o">.</span><span class="n">fastaccess</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span><span class="s1">&#39;ndim&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;length_</span><span class="si">{idx}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_finalise_connections</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_fastaccessattribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">suffix</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;_</span><span class="si">{self.name}</span><span class="s1">_</span><span class="si">{suffix}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_fastaccessattribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">suffix</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;_</span><span class="si">{self.name}</span><span class="s1">_</span><span class="si">{suffix}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_finalise_connections</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;A hook method, called at the end of method</span>
<span class="sd">        `__hydpy__connect_variable2subgroup__` for initialising</span>
<span class="sd">        values and some related attributes, eventually.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">()</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The prefered way to pass values to |Sequence| instances</span>
<span class="sd">        within initial condition files.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">args</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">initinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;A |tuple| containing the initial value and |True| or a missing</span>
<span class="sd">        value and |False|, depending on the actual |Sequence| subclass and</span>
<span class="sd">        the actual value of option |Options.usedefaultvalues|.</span>

<span class="sd">        In the following, we do not explain property |Sequence.initinfo|</span>
<span class="sd">        itself but show how it affects initialising new |Sequence| objects.</span>
<span class="sd">        Therefore, let us define a sequence test class and prepare a</span>
<span class="sd">        function for initialising it and connecting the resulting instance</span>
<span class="sd">        to a |ModelSequences| object:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.sequencetools import Sequence, ModelSequences</span>
<span class="sd">        &gt;&gt;&gt; class Test(Sequence):</span>
<span class="sd">        ...     NDIM = 0</span>
<span class="sd">        &gt;&gt;&gt; class SubGroup(ModelSequences):</span>
<span class="sd">        ...     CLASSES = (Test,)</span>
<span class="sd">        &gt;&gt;&gt; def prepare():</span>
<span class="sd">        ...     subseqs = SubGroup(None)</span>
<span class="sd">        ...     test = Test(subseqs)</span>
<span class="sd">        ...     test.__hydpy__connect_variable2subgroup__()</span>
<span class="sd">        ...     return test</span>

<span class="sd">        By default, making use of the `INIT` attribute is disabled:</span>

<span class="sd">        &gt;&gt;&gt; prepare()</span>
<span class="sd">        test(nan)</span>

<span class="sd">        Enable it through setting |Options.usedefaultvalues| to |True|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; with pub.options.usedefaultvalues(True):</span>
<span class="sd">        ...     prepare()</span>
<span class="sd">        test(0.0)</span>

<span class="sd">        Attribute `INIT` of class |Sequence| comes with the value `0.0`</span>
<span class="sd">        by default, which should be reasonable for most |Sequence|</span>
<span class="sd">        subclasses.  However, subclasses can define other values.</span>
<span class="sd">        Most importantly, note the possibility to set `INIT` to `None`</span>
<span class="sd">        for sequences that do not allow defining a reasonabe initial</span>
<span class="sd">        value for all possible situations:</span>

<span class="sd">        &gt;&gt;&gt; Test.INIT = None</span>
<span class="sd">        &gt;&gt;&gt; prepare()</span>
<span class="sd">        test(nan)</span>
<span class="sd">        &gt;&gt;&gt; with pub.options.usedefaultvalues(True):</span>
<span class="sd">        ...     prepare()</span>
<span class="sd">        test(nan)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">usedefaultvalues</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">INIT</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">INIT</span><span class="p">,</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">islong</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">255</span>
        <span class="k">return</span> <span class="n">variabletools</span><span class="o">.</span><span class="n">to_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">islong</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core.sequencetools import Sequence</span>
<span class="sd">        &gt;&gt;&gt; sequence = Sequence(None)</span>
<span class="sd">        &gt;&gt;&gt; dir(sequence)</span>
<span class="sd">        [&#39;INIT&#39;, &#39;NOT_DEEPCOPYABLE_MEMBERS&#39;, &#39;SPAN&#39;, &#39;TYPE&#39;, \</span>
<span class="sd">&#39;availablemasks&#39;, &#39;average_values&#39;, &#39;commentrepr&#39;, &#39;fastaccess&#39;, \</span>
<span class="sd">&#39;get_submask&#39;, &#39;initinfo&#39;, &#39;mask&#39;, &#39;name&#39;, &#39;refweights&#39;, &#39;shape&#39;, \</span>
<span class="sd">&#39;strict_valuehandling&#39;, &#39;subseqs&#39;, &#39;subvars&#39;, &#39;value&#39;, &#39;values&#39;, &#39;verify&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">dir_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">_IOProperty</span><span class="p">(</span><span class="n">propertytools</span><span class="o">.</span><span class="n">DefaultProperty</span><span class="p">):</span>

    <span class="n">DOCSTRING</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">fget</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__fget</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__set_name__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objtype</span><span class="p">:</span> <span class="n">Type</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__set_name__</span><span class="p">(</span><span class="n">objtype</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">attr_seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">classname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objtype</span><span class="p">)</span>
        <span class="n">attr_man</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;{cls.lower()[:-8]}{self.name.split(&quot;_&quot;)[0]}&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__attr_manager</span> <span class="o">=</span> <span class="n">attr_man</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_doc</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            </span><span class="si">{self.DOCSTRING}</span><span class="s2"></span>

<span class="s2">        Attribute </span><span class="si">{attr_seq}</span><span class="s2"> is connected with attribute </span><span class="si">{attr_man}</span><span class="s2"> of </span>
<span class="s2">        class |SequenceManager|, as shown by the following technical </span>
<span class="s2">        example (see the documentation on class |IOSequence| for some </span>
<span class="s2">        explanations on the usage of this and similar properties of </span>
<span class="s2">        |IOSequence| subclasses):</span>

<span class="s2">        &gt;&gt;&gt; from hydpy.core.filetools import SequenceManager</span>
<span class="s2">        &gt;&gt;&gt; temp = SequenceManager.</span><span class="si">{attr_man}</span><span class="s2"></span>
<span class="s2">        &gt;&gt;&gt; SequenceManager.</span><span class="si">{attr_man}</span><span class="s2"> = &#39;global&#39;</span>
<span class="s2">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="s2">        &gt;&gt;&gt; pub.sequencemanager = SequenceManager()</span>
<span class="s2">        &gt;&gt;&gt; from hydpy.core.sequencetools import </span><span class="si">{cls}</span><span class="s2"></span>
<span class="s2">        &gt;&gt;&gt; sequence = </span><span class="si">{cls}</span><span class="s2">(None)</span>
<span class="s2">        &gt;&gt;&gt; sequence.</span><span class="si">{attr_seq}</span><span class="s2"></span>
<span class="s2">        &#39;global&#39;</span>
<span class="s2">        &gt;&gt;&gt; sequence.</span><span class="si">{attr_seq}</span><span class="s2"> = &#39;local&#39;</span>
<span class="s2">        &gt;&gt;&gt; sequence.</span><span class="si">{attr_seq}</span><span class="s2"></span>
<span class="s2">        &#39;local&#39;</span>
<span class="s2">        &gt;&gt;&gt; del sequence.</span><span class="si">{attr_seq}</span><span class="s2"></span>
<span class="s2">        &gt;&gt;&gt; sequence.</span><span class="si">{attr_seq}</span><span class="s2"></span>
<span class="s2">        &#39;global&#39;</span>
<span class="s2">        &gt;&gt;&gt; SequenceManager.</span><span class="si">{attr_man}</span><span class="s2"> = temp</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__fget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">manager</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">sequencemanager</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;For sequence {objecttools.devicephrase(obj)} attribute &#39;</span>
                <span class="n">f</span><span class="s1">&#39;</span><span class="si">{self.name}</span><span class="s1"> cannot be determined.  Either set it manually &#39;</span>
                <span class="s1">&#39;or prepare `pub.sequencemanager` correctly.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__attr_manager</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_FileType</span><span class="p">(</span><span class="n">_IOProperty</span><span class="p">):</span>

    <span class="n">DOCSTRING</span> <span class="o">=</span> <span class="s1">&#39;Ending of the external data file.&#39;</span>


<span class="k">class</span> <span class="nc">_DirPathProperty</span><span class="p">(</span><span class="n">_IOProperty</span><span class="p">):</span>

    <span class="n">DOCSTRING</span> <span class="o">=</span> <span class="s1">&#39;Absolute path of the directory of the external data file.&#39;</span>


<span class="k">class</span> <span class="nc">_AggregationProperty</span><span class="p">(</span><span class="n">_IOProperty</span><span class="p">):</span>

    <span class="n">DOCSTRING</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Type of aggregation performed when writing the &#39;</span>
                 <span class="s1">&#39;time series data to an external data file.&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_OverwriteProperty</span><span class="p">(</span><span class="n">_IOProperty</span><span class="p">):</span>

    <span class="n">DOCSTRING</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;True/False flag indicating if overwriting an existing &#39;</span>
                 <span class="s1">&#39;data file is allowed or not.&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="IOSequence"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.IOSequence">[docs]</a><span class="k">class</span> <span class="nc">IOSequence</span><span class="p">(</span><span class="n">Sequence</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for sequences with input/output functionalities.</span>

<span class="sd">    The |IOSequence| subclasses |InputSequence|, |FluxSequence|,</span>
<span class="sd">    |StateSequence|, and |NodeSequence| all implement similar</span>
<span class="sd">    special properties, which configure the processes of reading</span>
<span class="sd">    and writing time series files.  In the following, property</span>
<span class="sd">    `filetype_ext` is taken as an example to explain how to</span>
<span class="sd">    handle them:</span>

<span class="sd">    Usually, each sequence queries its current &quot;external&quot; file type</span>
<span class="sd">    from the |SequenceManager| object stored in module |pub|:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">    &gt;&gt;&gt; from hydpy.core.filetools import SequenceManager</span>
<span class="sd">    &gt;&gt;&gt; pub.sequencemanager = SequenceManager()</span>

<span class="sd">    Depending if the actual sequence stems from |InputSequence|,</span>
<span class="sd">    |FluxSequence|,  |StateSequence|, or |NodeSequence|, either</span>
<span class="sd">    |SequenceManager.inputfiletype|, |SequenceManager.fluxfiletype|,</span>
<span class="sd">    |SequenceManager.statefiletype|, or |SequenceManager.nodefiletype|</span>
<span class="sd">    are queried:</span>

<span class="sd">    &gt;&gt;&gt; pub.sequencemanager.inputfiletype = &#39;npy&#39;</span>
<span class="sd">    &gt;&gt;&gt; pub.sequencemanager.fluxfiletype = &#39;asc&#39;</span>
<span class="sd">    &gt;&gt;&gt; pub.sequencemanager.nodefiletype = &#39;nc&#39;</span>
<span class="sd">    &gt;&gt;&gt; from hydpy.core import sequencetools as st</span>
<span class="sd">    &gt;&gt;&gt; st.InputSequence(None).filetype_ext</span>
<span class="sd">    &#39;npy&#39;</span>
<span class="sd">    &gt;&gt;&gt; st.FluxSequence(None).filetype_ext</span>
<span class="sd">    &#39;asc&#39;</span>
<span class="sd">    &gt;&gt;&gt; st.NodeSequence(None).filetype_ext</span>
<span class="sd">    &#39;nc&#39;</span>

<span class="sd">    Alternatively, you can specify `filetype_ext` for each sequence</span>
<span class="sd">    object individually:</span>

<span class="sd">    &gt;&gt;&gt; seq = st.InputSequence(None)</span>
<span class="sd">    &gt;&gt;&gt; seq.filetype_ext</span>
<span class="sd">    &#39;npy&#39;</span>
<span class="sd">    &gt;&gt;&gt; seq.filetype_ext = &#39;nc&#39;</span>
<span class="sd">    &gt;&gt;&gt; seq.filetype_ext</span>
<span class="sd">    &#39;nc&#39;</span>
<span class="sd">    &gt;&gt;&gt; del seq.filetype_ext</span>
<span class="sd">    &gt;&gt;&gt; seq.filetype_ext</span>
<span class="sd">    &#39;npy&#39;</span>

<span class="sd">    If neither a specific definition nor a |SequenceManager| object</span>
<span class="sd">    is available, property `filetype_ext` raises the following error:</span>

<span class="sd">    &gt;&gt;&gt; del pub.sequencemanager</span>
<span class="sd">    &gt;&gt;&gt; seq.filetype_ext</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    RuntimeError: For sequence `inputsequence` attribute filetype_ext \</span>
<span class="sd">cannot be determined.  Either set it manually or prepare \</span>
<span class="sd">`pub.sequencemanager` correctly.</span>

<span class="sd">    How to read and write time series files is explained in the</span>
<span class="sd">    documentation on modules |filetools| and |netcdftools| in some</span>
<span class="sd">    detail.  However, reading and writing time series files is</span>
<span class="sd">    disabled by default, due to reasons of efficiency.  You first</span>
<span class="sd">    need to prepare the |IOSequence.series| attribute of the</span>
<span class="sd">    relevant |IOSequence| objects.  Typically, you do this by calling</span>
<span class="sd">    methods like |HydPy.prepare_inputseries| of class |HydPy|.</span>
<span class="sd">    Here, we use the related features the |IOSequence| class itself,</span>
<span class="sd">    which is a little more complicated but also more flexible when</span>
<span class="sd">    scripting complex workflows.</span>

<span class="sd">    We use the `LahnH` example project and focus on the `input`</span>
<span class="sd">    and `flux` sequences:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.examples import prepare_full_example_2</span>

<span class="sd">    &gt;&gt;&gt; hp, pub, TestIO = prepare_full_example_2()</span>
<span class="sd">    &gt;&gt;&gt; inputs = hp.elements.land_lahn_1.model.sequences.inputs</span>
<span class="sd">    &gt;&gt;&gt; fluxes = hp.elements.land_lahn_1.model.sequences.fluxes</span>

<span class="sd">    |IOSequence| objects come with the properties |IOSequence.ramflag|</span>
<span class="sd">    and |IOSequence.diskflag|, telling if the respective time series is</span>
<span class="sd">    available in RAM, on disk, or not available at all.  Input sequences</span>
<span class="sd">    are the only ones who need to have one flag activated. Otherwise,</span>
<span class="sd">    the input series would not be available during simulation runs.</span>
<span class="sd">    For example, input sequence |hland_inputs.T| stores its time series</span>
<span class="sd">    data in RAM internally, which is the much faster approach and should</span>
<span class="sd">    be preferred, as long as limited storage is not an issue:</span>

<span class="sd">    &gt;&gt;&gt; inputs.t.ramflag</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; inputs.t.diskflag</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; from hydpy import repr_, round_</span>
<span class="sd">    &gt;&gt;&gt; round_(inputs.t.series, 1)</span>
<span class="sd">    -0.7, -1.5, -4.2, -7.4</span>

<span class="sd">    Convenience function |prepare_full_example_2| also activates the</span>
<span class="sd">    |IOSequence.ramflag| of all flux sequences, which is not necessary</span>
<span class="sd">    to perform a successful simulation but is required to query the</span>
<span class="sd">    complete time series of simulated values afterwards (otherwise,</span>
<span class="sd">    only the last simulated value would available after a simulation run):</span>

<span class="sd">    &gt;&gt;&gt; fluxes.tc.ramflag</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; round_(fluxes.tc.series[:, 0])</span>
<span class="sd">    nan, nan, nan, nan</span>

<span class="sd">    Use |IOSequence.activate_ram| or |IOSequence.activate_disk| to</span>
<span class="sd">    force a sequence to handle time series data in RAM or on disk,</span>
<span class="sd">    respectively.  We now activate the |IOSequence.diskflag| of flux</span>
<span class="sd">    sequence |hland_fluxes.TMean| (which automatically disables the</span>
<span class="sd">    |IOSequence.ramflag|).  Note that we need to change the current</span>
<span class="sd">    working directory to the `iotesting` directory temporarily (by</span>
<span class="sd">    using class |TestIO|) to make sure to create that the related</span>
<span class="sd">    file in the right directory:</span>

<span class="sd">    &gt;&gt;&gt; with TestIO():</span>
<span class="sd">    ...     fluxes.tmean.activate_disk()</span>
<span class="sd">    ...     repr_(fluxes.tmean.filepath_int)    # doctest: +ELLIPSIS</span>
<span class="sd">    &#39;...iotesting/LahnH/series/temp/land_lahn_1_flux_tmean.bin&#39;</span>

<span class="sd">    The user can access the time series data in the same manner as</span>
<span class="sd">    if being handled in RAM:</span>

<span class="sd">    &gt;&gt;&gt; fluxes.tmean.ramflag</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; fluxes.tmean.diskflag</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; with TestIO():</span>
<span class="sd">    ...     round_(fluxes.tmean.series)</span>
<span class="sd">    nan, nan, nan, nan</span>

<span class="sd">    For completeness of testing, we also activate the |IOSequence.diskflag|</span>
<span class="sd">    of a 1-dimensional sequence:</span>

<span class="sd">    &gt;&gt;&gt; from pprint import pprint</span>
<span class="sd">    &gt;&gt;&gt; with TestIO():</span>
<span class="sd">    ...     fluxes.fracrain.activate_disk()</span>
<span class="sd">    ...     pprint(sorted(os.listdir(&#39;LahnH/series/temp&#39;)))</span>
<span class="sd">    [&#39;land_lahn_1_flux_fracrain.bin&#39;, &#39;land_lahn_1_flux_tmean.bin&#39;]</span>

<span class="sd">    Apply methods |IOSequence.deactivate_ram| or |IOSequence.deactivate_disk|</span>
<span class="sd">    for sequences that do not provide data relevant for your analysis:</span>

<span class="sd">    &gt;&gt;&gt; fluxes.ep.deactivate_ram()</span>
<span class="sd">    &gt;&gt;&gt; fluxes.ep.ramflag</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; fluxes.ep.diskflag</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; fluxes.ep.series</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeError: Sequence `ep` of element `land_lahn_1` is not \</span>
<span class="sd">requested to make any internal data available.</span>

<span class="sd">    After a simulation run, the |IOSequence.series| of flux sequence</span>
<span class="sd">    |hland_fluxes.EP| is still not available but the time series data</span>
<span class="sd">    of the other discussed series with either true |IOSequence.ramflag|</span>
<span class="sd">    or |IOSequence.diskflag| values are:</span>

<span class="sd">    &gt;&gt;&gt; with TestIO():</span>
<span class="sd">    ...     hp.simulate()</span>

<span class="sd">    &gt;&gt;&gt; fluxes.ep.series = 1.0</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeError: Sequence `ep` of element `land_lahn_1` is not \</span>
<span class="sd">requested to make any internal data available.</span>

<span class="sd">    &gt;&gt;&gt; round_(fluxes.q1.series, 1)</span>
<span class="sd">    0.4, 0.4, 0.4, 0.4</span>
<span class="sd">    &gt;&gt;&gt; round_(fluxes.tc.series[:, 0], 1)</span>
<span class="sd">    0.2, -0.6, -3.4, -6.6</span>
<span class="sd">    &gt;&gt;&gt; with TestIO():</span>
<span class="sd">    ...     round_(fluxes.tmean.series, 1)</span>
<span class="sd">    -1.0, -1.8, -4.5, -7.7</span>
<span class="sd">    &gt;&gt;&gt; with TestIO():</span>
<span class="sd">    ...     round_(fluxes.fracrain.series[:, 0], 1)</span>
<span class="sd">    0.3, 0.0, 0.0, 0.0</span>

<span class="sd">    You cannot only access the time series data of individual |IOSequence|</span>
<span class="sd">    objects, but you can also modify it.  See, for example, the simulated time</span>
<span class="sd">    series for flux sequence |hland_fluxes.PC| (adjusted precipitation),</span>
<span class="sd">    which is zero, because the values of input sequence |hland_inputs.P|</span>
<span class="sd">    (given precipitation) are also zero:</span>

<span class="sd">    &gt;&gt;&gt; round_(fluxes.pc.series[:, 0], 1)</span>
<span class="sd">    0.0, 0.0, 0.0, 0.0</span>

<span class="sd">    We can assign different values to attribute |IOSequence.series| of</span>
<span class="sd">    sequence |hland_inputs.P|, perform a new simulation run, and see that</span>
<span class="sd">    the newly calculated time series of sequence |hland_fluxes.PC|</span>
<span class="sd">    reflects our data modification:</span>

<span class="sd">    &gt;&gt;&gt; inputs.p.ramflag</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; inputs.p.series = 10.0</span>
<span class="sd">    &gt;&gt;&gt; with TestIO():</span>
<span class="sd">    ...     hp.simulate()</span>
<span class="sd">    &gt;&gt;&gt; round_(fluxes.pc.series[:, 0], 1)</span>
<span class="sd">    10.2, 11.3, 11.3, 11.3</span>

<span class="sd">    Next, we show that the same feature works for time series data</span>
<span class="sd">    handled on disk.  Therefore, we first call method |IOSequence.ram2disk|,</span>
<span class="sd">    which disables |IOSequence.ramflag| and enables |IOSequence.diskflag|</span>
<span class="sd">    without any loss of information:</span>

<span class="sd">    &gt;&gt;&gt; with TestIO():</span>
<span class="sd">    ...     inputs.p.ram2disk()</span>
<span class="sd">    ...     pprint(sorted(os.listdir(&#39;LahnH/series/temp&#39;)))</span>
<span class="sd">    [&#39;land_lahn_1_flux_fracrain.bin&#39;,</span>
<span class="sd">     &#39;land_lahn_1_flux_tmean.bin&#39;,</span>
<span class="sd">     &#39;land_lahn_1_input_p.bin&#39;]</span>
<span class="sd">    &gt;&gt;&gt; inputs.p.ramflag</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; inputs.p.diskflag</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; with TestIO():</span>
<span class="sd">    ...     round_(inputs.p.series, 1)</span>
<span class="sd">    10.0, 10.0, 10.0, 10.0</span>

<span class="sd">    Data modifications still influence simulation runs as to be expected:</span>

<span class="sd">    &gt;&gt;&gt; with TestIO():</span>
<span class="sd">    ...     inputs.p.series = 20.0</span>
<span class="sd">    ...     hp.simulate()</span>
<span class="sd">    ...     round_(fluxes.pc.series[:, 0], 1)</span>
<span class="sd">    20.5, 22.6, 22.6, 22.6</span>

<span class="sd">    Method |IOSequence.disk2ram| is the counterpart to |IOSequence.ram2disk|:</span>

<span class="sd">    &gt;&gt;&gt; with TestIO():</span>
<span class="sd">    ...     inputs.p.disk2ram()</span>
<span class="sd">    ...     pprint(sorted(os.listdir(&#39;LahnH/series/temp&#39;)))</span>
<span class="sd">    [&#39;land_lahn_1_flux_fracrain.bin&#39;, &#39;land_lahn_1_flux_tmean.bin&#39;]</span>
<span class="sd">    &gt;&gt;&gt; inputs.p.ramflag</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; inputs.p.diskflag</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; round_(inputs.p.series, 1)</span>
<span class="sd">    20.0, 20.0, 20.0, 20.0</span>

<span class="sd">    Method |IOSequence.deactivate_disk| works analogue to</span>
<span class="sd">    |IOSequence.deactivate_ram|:</span>

<span class="sd">    &gt;&gt;&gt; with TestIO():</span>
<span class="sd">    ...     fluxes.fracrain.deactivate_disk()</span>
<span class="sd">    ...     pprint(sorted(os.listdir(&#39;LahnH/series/temp&#39;)))</span>
<span class="sd">    [&#39;land_lahn_1_flux_tmean.bin&#39;]</span>
<span class="sd">    &gt;&gt;&gt; fluxes.fracrain.ramflag</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; fluxes.fracrain.diskflag</span>
<span class="sd">    False</span>

<span class="sd">    Both methods |IOSequence.deactivate_ram| and |IOSequence.deactivate_disk|</span>
<span class="sd">    do nothing in case the respective flag is |False| already:</span>

<span class="sd">    &gt;&gt;&gt; fluxes.pc.deactivate_ram()</span>
<span class="sd">    &gt;&gt;&gt; with TestIO():</span>
<span class="sd">    ...     fluxes.fracrain.deactivate_disk()</span>

<span class="sd">    You can query property |IOSequence.memoryflag|, if you are only</span>
<span class="sd">    interested to know if a sequence handles stores its time series</span>
<span class="sd">    data, but not how:</span>

<span class="sd">    &gt;&gt;&gt; fluxes.pc.memoryflag</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; fluxes.tmean.memoryflag</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; inputs.p.memoryflag</span>
<span class="sd">    True</span>

<span class="sd">    Another convenience property is |IOSequence.seriesshape|, which</span>
<span class="sd">    combines the length of the simulation period with the shape of</span>
<span class="sd">    the individual |IOSequence| object:</span>

<span class="sd">    &gt;&gt;&gt; inputs.p.seriesshape</span>
<span class="sd">    (4,)</span>
<span class="sd">    &gt;&gt;&gt; fluxes.pc.seriesshape</span>
<span class="sd">    (4, 13)</span>

<span class="sd">    Note that resetting the |IOSequence.shape| of am |IOSequence| object</span>
<span class="sd">    does not change how it handles its internal time series data, but</span>
<span class="sd">    results in a loss of current information:</span>

<span class="sd">    &gt;&gt;&gt; fluxes.tc.seriesshape</span>
<span class="sd">    (4, 13)</span>
<span class="sd">    &gt;&gt;&gt; fluxes.fastaccess._tc_length</span>
<span class="sd">    13</span>
<span class="sd">    &gt;&gt;&gt; round_(fluxes.tc.series[:, 0], 1)</span>
<span class="sd">    0.2, -0.6, -3.4, -6.6</span>

<span class="sd">    &gt;&gt;&gt; fluxes.tc.shape = (2,)</span>
<span class="sd">    &gt;&gt;&gt; fluxes.tc.seriesshape</span>
<span class="sd">    (4, 2)</span>
<span class="sd">    &gt;&gt;&gt; fluxes.fastaccess._tc_length</span>
<span class="sd">    2</span>
<span class="sd">    &gt;&gt;&gt; round_(fluxes.tc.series[:, 0], 1)</span>
<span class="sd">    nan, nan, nan, nan</span>

<span class="sd">    Resetting the |IOSequence.shape| of |IOSequence| objects which</span>
<span class="sd">    are not storing their internal time series data works too:</span>

<span class="sd">    &gt;&gt;&gt; fluxes.pc.seriesshape</span>
<span class="sd">    (4, 13)</span>
<span class="sd">    &gt;&gt;&gt; fluxes.fastaccess._pc_length</span>
<span class="sd">    13</span>
<span class="sd">    &gt;&gt;&gt; round_(fluxes.pc.series[:, 0], 1)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeError: Sequence `pc` of element `land_lahn_1` is not \</span>
<span class="sd">requested to make any internal data available.</span>

<span class="sd">    &gt;&gt;&gt; fluxes.pc.shape = (2,)</span>
<span class="sd">    &gt;&gt;&gt; fluxes.pc.seriesshape</span>
<span class="sd">    (4, 2)</span>
<span class="sd">    &gt;&gt;&gt; fluxes.fastaccess._pc_length</span>
<span class="sd">    2</span>
<span class="sd">    &gt;&gt;&gt; round_(fluxes.pc.series[:, 0], 1)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeError: Sequence `pc` of element `land_lahn_1` is not \</span>
<span class="sd">requested to make any internal data available.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">filetype_ext</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">_FileType</span><span class="p">]</span>
    <span class="n">dirpath_ext</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">_DirPathProperty</span><span class="p">]</span>
    <span class="n">aggregation_ext</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">_AggregationProperty</span><span class="p">]</span>
    <span class="n">overwrite_ext</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">_OverwriteProperty</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_finalise_connections</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span><span class="s1">&#39;ramflag&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span><span class="s1">&#39;diskflag&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_finalise_connections</span><span class="p">()</span>

    <span class="nd">@propertytools</span><span class="o">.</span><span class="n">DefaultProperty</span>
    <span class="k">def</span> <span class="nf">rawfilename</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;|DefaultProperty| handling the filename without ending for</span>
<span class="sd">        external and internal data files.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.sequencetools import IOSequence</span>
<span class="sd">        &gt;&gt;&gt; class Test(IOSequence):</span>
<span class="sd">        ...     descr_device = &#39;node1&#39;</span>
<span class="sd">        ...     descr_sequence = &#39;subgroup_test&#39;</span>
<span class="sd">        &gt;&gt;&gt; Test(None).rawfilename</span>
<span class="sd">        &#39;node1_subgroup_test&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{self.descr_device}</span><span class="s1">_</span><span class="si">{self.descr_sequence}</span><span class="s1">&#39;</span>

    <span class="nd">@propertytools</span><span class="o">.</span><span class="n">DefaultProperty</span>
    <span class="k">def</span> <span class="nf">filename_ext</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The full filename of the external data file.</span>

<span class="sd">        The &quot;external&quot; filename consists of |IOSequence.rawfilename| and</span>
<span class="sd">        of |FluxSequence.filetype_ext|.  For simplicity, we add the</span>
<span class="sd">        attribute `rawfilename` to the initialised sequence object</span>
<span class="sd">        in the following example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.sequencetools import ModelSequence</span>
<span class="sd">        &gt;&gt;&gt; seq = ModelSequence(None)</span>
<span class="sd">        &gt;&gt;&gt; seq.rawfilename = &#39;test&#39;</span>
<span class="sd">        &gt;&gt;&gt; seq.filetype_ext = &#39;nc&#39;</span>
<span class="sd">        &gt;&gt;&gt; seq.filename_ext</span>
<span class="sd">        &#39;test.nc&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">rawfilename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype_ext</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">filename_int</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The full filename of the internal data file.</span>

<span class="sd">        The &quot;internal&quot; filename consists of |IOSequence.rawfilename|</span>
<span class="sd">        and the file ending `.bin`.  For simplicity, we add the</span>
<span class="sd">        attribute `rawfilename` to the initialised sequence object</span>
<span class="sd">        in the following example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.sequencetools import ModelSequence</span>
<span class="sd">        &gt;&gt;&gt; seq = ModelSequence(None)</span>
<span class="sd">        &gt;&gt;&gt; seq.rawfilename = &#39;test&#39;</span>
<span class="sd">        &gt;&gt;&gt; seq.filename_int</span>
<span class="sd">        &#39;test.bin&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawfilename</span> <span class="o">+</span> <span class="s1">&#39;.bin&#39;</span>

    <span class="nd">@propertytools</span><span class="o">.</span><span class="n">DefaultProperty</span>
    <span class="k">def</span> <span class="nf">dirpath_int</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The absolute path of the directory of the internal data file.</span>

<span class="sd">        Usually, each sequence queries its current &quot;internal&quot; directory</span>
<span class="sd">        path from the |SequenceManager| object stored in module |pub|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub, repr_, TestIO</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core.filetools import SequenceManager</span>
<span class="sd">        &gt;&gt;&gt; pub.sequencemanager = SequenceManager()</span>

<span class="sd">        We overwrite |FileManager.basepath| and prepare a folder in the</span>
<span class="sd">        `iotesting` directory to simplify the following examples:</span>

<span class="sd">        &gt;&gt;&gt; basepath = SequenceManager.basepath</span>
<span class="sd">        &gt;&gt;&gt; SequenceManager.basepath = &#39;test&#39;</span>
<span class="sd">        &gt;&gt;&gt; TestIO.clear()</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     os.makedirs(&#39;test/temp&#39;)</span>

<span class="sd">        Generally, property |IOSequence.dirpath_int| queries</span>
<span class="sd">        property |SequenceManager.tempdirpath|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core import sequencetools as st</span>
<span class="sd">        &gt;&gt;&gt; seq = st.InputSequence(None)</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     repr_(seq.dirpath_int)</span>
<span class="sd">        &#39;test/temp&#39;</span>

<span class="sd">        Alternatively, you can specify |IOSequence.dirpath_int| for each</span>
<span class="sd">        sequence object individually:</span>

<span class="sd">        &gt;&gt;&gt; seq.dirpath_int = &#39;path&#39;</span>
<span class="sd">        &gt;&gt;&gt; os.path.split(seq.dirpath_int)</span>
<span class="sd">        (&#39;&#39;, &#39;path&#39;)</span>
<span class="sd">        &gt;&gt;&gt; del seq.dirpath_int</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     os.path.split(seq.dirpath_int)</span>
<span class="sd">        (&#39;test&#39;, &#39;temp&#39;)</span>

<span class="sd">        If neither a specific definition nor a |SequenceManager| object</span>
<span class="sd">        is, property `dirpath_int` raises the following error:</span>

<span class="sd">        &gt;&gt;&gt; del pub.sequencemanager</span>
<span class="sd">        &gt;&gt;&gt; seq.dirpath_int</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: For sequence `inputsequence` the directory of \</span>
<span class="sd">the internal data file cannot be determined.  Either set it manually \</span>
<span class="sd">or prepare `pub.sequencemanager` correctly.</span>

<span class="sd">        Remove the `basepath` mock:</span>

<span class="sd">        &gt;&gt;&gt; SequenceManager.basepath = basepath</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">sequencemanager</span><span class="o">.</span><span class="n">tempdirpath</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;For sequence {objecttools.devicephrase(self)} &#39;</span>
                <span class="n">f</span><span class="s1">&#39;the directory of the internal data file cannot &#39;</span>
                <span class="n">f</span><span class="s1">&#39;be determined.  Either set it manually or prepare &#39;</span>
                <span class="n">f</span><span class="s1">&#39;`pub.sequencemanager` correctly.&#39;</span><span class="p">)</span>

    <span class="nd">@propertytools</span><span class="o">.</span><span class="n">DefaultProperty</span>
    <span class="k">def</span> <span class="nf">filepath_ext</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The absolute path to the external data file.</span>

<span class="sd">        The path pointing to the &quot;external&quot; file consists of</span>
<span class="sd">        |FluxSequence.dirpath_ext| and |IOSequence.filename_ext|.  For</span>
<span class="sd">        simplicity, we define both manually in the following example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.sequencetools import ModelSequence</span>
<span class="sd">        &gt;&gt;&gt; seq = ModelSequence(None)</span>
<span class="sd">        &gt;&gt;&gt; seq.dirpath_ext = &#39;path&#39;</span>
<span class="sd">        &gt;&gt;&gt; seq.filename_ext = &#39;file.npy&#39;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import repr_</span>
<span class="sd">        &gt;&gt;&gt; repr_(seq.filepath_ext)</span>
<span class="sd">        &#39;path/file.npy&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath_ext</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_ext</span><span class="p">)</span>

    <span class="nd">@propertytools</span><span class="o">.</span><span class="n">DefaultProperty</span>
    <span class="k">def</span> <span class="nf">filepath_int</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The absolute path to the internal data file.</span>

<span class="sd">        The path pointing to the &quot;internal&quot; file consists of</span>
<span class="sd">        |IOSequence.dirpath_int| and |IOSequence.filename_int|, which</span>
<span class="sd">        itself is defined by `rawfilename`.  For simplicity, we define</span>
<span class="sd">        both manually in the following example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.sequencetools import ModelSequence</span>
<span class="sd">        &gt;&gt;&gt; seq = ModelSequence(None)</span>
<span class="sd">        &gt;&gt;&gt; seq.dirpath_int = &#39;path&#39;</span>
<span class="sd">        &gt;&gt;&gt; seq.rawfilename = &#39;file&#39;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import repr_</span>
<span class="sd">        &gt;&gt;&gt; repr_(seq.filepath_int)</span>
<span class="sd">        &#39;path/file.bin&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirpath_int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_int</span><span class="p">)</span>

<div class="viewcode-block" id="IOSequence.update_fastaccess"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.IOSequence.update_fastaccess">[docs]</a>    <span class="k">def</span> <span class="nf">update_fastaccess</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Update the |FastAccessSequence| object handled by the actual</span>
<span class="sd">        |IOSequence| object.</span>

<span class="sd">        Users do not need to apply the method |IOSequence.update_fastaccess|</span>
<span class="sd">        directly.  The following information should be relevant for</span>
<span class="sd">        framework developers only.</span>

<span class="sd">        The main documentation on class |Sequence| mentions that the</span>
<span class="sd">        |FastAccessSequence| attribute handles some information about</span>
<span class="sd">        its sequences, but this information needs to be kept up-to-date</span>
<span class="sd">        by the sequences themselves.  This updating is the task of method</span>
<span class="sd">        |IOSequence.update_fastaccess|, which some other methods of class</span>
<span class="sd">        |IOSequence| call.  We show this via the hidden attribute `length`,</span>
<span class="sd">        which is 0 after initialisation, and automatically set to another</span>
<span class="sd">        value when assigning it to property |IOSequence.shape| of</span>
<span class="sd">        |IOSequence| subclasses as |lland_fluxes.NKor|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model</span>
<span class="sd">        &gt;&gt;&gt; model = prepare_model(&#39;lland_v1&#39;)</span>
<span class="sd">        &gt;&gt;&gt; nkor = model.sequences.fluxes.nkor</span>
<span class="sd">        &gt;&gt;&gt; nkor.fastaccess._nkor_length</span>
<span class="sd">        0</span>
<span class="sd">        &gt;&gt;&gt; nkor.shape = (3,)</span>
<span class="sd">        &gt;&gt;&gt; nkor.fastaccess._nkor_length</span>
<span class="sd">        3</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">diskflag</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filepath_int</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="n">length</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="p">):</span>
            <span class="n">length</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;length_</span><span class="si">{idx}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span></div>

<div class="viewcode-block" id="IOSequence.activate_ram"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.IOSequence.activate_ram">[docs]</a>    <span class="k">def</span> <span class="nf">activate_ram</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Demand reading/writing internal data from/to RAM.</span>

<span class="sd">        See the main documentation on class |IOSequence| for further</span>
<span class="sd">        information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deactivate_disk</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span><span class="s1">&#39;ramflag&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_activate</span><span class="p">()</span></div>

<div class="viewcode-block" id="IOSequence.activate_disk"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.IOSequence.activate_disk">[docs]</a>    <span class="k">def</span> <span class="nf">activate_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Demand reading/writing internal data from/to hard disk.</span>

<span class="sd">        See the main documentation on class |IOSequence| for further</span>
<span class="sd">        information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deactivate_ram</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span><span class="s1">&#39;diskflag&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_activate</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_activate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seriesshape</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ramflag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__set_array</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_int</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_fastaccess</span><span class="p">()</span>

<div class="viewcode-block" id="IOSequence.deactivate_ram"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.IOSequence.deactivate_ram">[docs]</a>    <span class="k">def</span> <span class="nf">deactivate_ram</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Prevent from reading/writing internal data from/to hard disk.</span>

<span class="sd">        See the main documentation on class |IOSequence| for further</span>
<span class="sd">        information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ramflag</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span><span class="s1">&#39;ramflag&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="IOSequence.deactivate_disk"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.IOSequence.deactivate_disk">[docs]</a>    <span class="k">def</span> <span class="nf">deactivate_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Prevent from reading/writing internal data from/to hard disk.</span>

<span class="sd">        See the main documentation on class |IOSequence| for further</span>
<span class="sd">        information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">diskflag</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span><span class="s1">&#39;diskflag&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="IOSequence.ram2disk"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.IOSequence.ram2disk">[docs]</a>    <span class="k">def</span> <span class="nf">ram2disk</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Move internal data from RAM to disk.</span>

<span class="sd">        See the main documentation on class |IOSequence| for further</span>
<span class="sd">        information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deactivate_ram</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span><span class="s1">&#39;diskflag&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_int</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_fastaccess</span><span class="p">()</span></div>

<div class="viewcode-block" id="IOSequence.disk2ram"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.IOSequence.disk2ram">[docs]</a>    <span class="k">def</span> <span class="nf">disk2ram</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Move internal data from disk to RAM.</span>

<span class="sd">        See the main documentation on class |IOSequence| for further</span>
<span class="sd">        information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deactivate_disk</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span><span class="s1">&#39;ramflag&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__set_array</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_fastaccess</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ramflag</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;A flag telling if the actual |IOSequence| object makes</span>
<span class="sd">        its internal time series data available using RAM space.</span>

<span class="sd">        See the main documentation on class |IOSequence| for further</span>
<span class="sd">        information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_fastaccessattribute</span><span class="p">(</span><span class="s1">&#39;ramflag&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">diskflag</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;A flag telling if the actual |IOSequence| object makes</span>
<span class="sd">        its internal time series data available using disk space.</span>

<span class="sd">        See the main documentation on class |IOSequence| for further</span>
<span class="sd">        information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_fastaccessattribute</span><span class="p">(</span><span class="s1">&#39;diskflag&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">memoryflag</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;A flag telling if the actual |IOSequence| object makes</span>
<span class="sd">        its internal time series data available somehow.</span>

<span class="sd">        See the main documentation on class |IOSequence| for further</span>
<span class="sd">        information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ramflag</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">diskflag</span>

    <span class="k">def</span> <span class="nf">__set_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span><span class="s1">&#39;array&#39;</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__hydpy__get_shape__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;A tuple containing the actual lengths of all dimensions.</span>

<span class="sd">        When setting a new |IOSequence.shape| of an |IOSequence| object,</span>
<span class="sd">        one automatically calls method |IOSequence.update_fastaccess|</span>
<span class="sd">        and, if necessary, prepares the new internal |IOSequence.series|</span>
<span class="sd">        array.</span>

<span class="sd">        See the main documentation on class |IOSequence| for further</span>
<span class="sd">        information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__hydpy__get_shape__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__hydpy__set_shape__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__hydpy__set_shape__</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">memoryflag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_activate</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_fastaccess</span><span class="p">()</span>

    <span class="n">shape</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">fget</span><span class="o">=</span><span class="n">__hydpy__get_shape__</span><span class="p">,</span> <span class="n">fset</span><span class="o">=</span><span class="n">__hydpy__set_shape__</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">seriesshape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;The shape of the whole time series (time being the first</span>
<span class="sd">        dimension).&quot;&quot;&quot;</span>
        <span class="n">seriesshape</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">timegrids</span><span class="o">.</span><span class="n">init</span><span class="p">)]</span>
        <span class="n">seriesshape</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">seriesshape</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">numericshape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;The shape of the array of temporary values required for the</span>
<span class="sd">        relevant numerical solver.</span>

<span class="sd">        The class |ELSModel|, being the base of the &quot;dam&quot; model, uses</span>
<span class="sd">        the &quot;Explicit Lobatto Sequence&quot; for solving differential equations</span>
<span class="sd">        and therefore requires up to eleven array fields for storing</span>
<span class="sd">        temporary values.  Hence, the |IOSequence.numericshape| of the</span>
<span class="sd">        0-dimensional sequence |dam_fluxes.Inflow| is eleven:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model</span>
<span class="sd">        &gt;&gt;&gt; model = prepare_model(&#39;dam&#39;)</span>
<span class="sd">        &gt;&gt;&gt; model.sequences.fluxes.inflow.numericshape</span>
<span class="sd">        (11,)</span>

<span class="sd">        Changing the |IOSequence.shape| through a little trick (just for</span>
<span class="sd">        demonstration purposes) shows that there are eleven entries for</span>
<span class="sd">        each &quot;normal&quot; |dam_fluxes.Inflow| value:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.dam.dam_fluxes import Inflow</span>
<span class="sd">        &gt;&gt;&gt; shape = Inflow.shape</span>
<span class="sd">        &gt;&gt;&gt; Inflow.shape = (2,)</span>
<span class="sd">        &gt;&gt;&gt; model.sequences.fluxes.inflow.numericshape</span>
<span class="sd">        (11, 2)</span>
<span class="sd">        &gt;&gt;&gt; Inflow.shape = shape</span>

<span class="sd">        Erroneous configurations result in the following error:</span>

<span class="sd">        &gt;&gt;&gt; del model.numconsts</span>
<span class="sd">        &gt;&gt;&gt; model.sequences.fluxes.inflow.numericshape</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        AttributeError: The `numericshape` of a sequence like `inflow` \</span>
<span class="sd">depends on the configuration of the actual integration algorithm.  \</span>
<span class="sd">While trying to query the required configuration data `nmb_stages` of \</span>
<span class="sd">the model associated with element `?`, the following error occurred: \</span>
<span class="sd">&#39;Model&#39; object has no attribute &#39;numconsts&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">numericshape</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">subseqs</span><span class="o">.</span><span class="n">seqs</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">numconsts</span><span class="o">.</span><span class="n">nmb_stages</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;The `numericshape` of a sequence like `</span><span class="si">{self.name}</span><span class="s1">` depends &#39;</span>
                <span class="n">f</span><span class="s1">&#39;on the configuration of the actual integration algorithm.  &#39;</span>
                <span class="n">f</span><span class="s1">&#39;While trying to query the required configuration data &#39;</span>
                <span class="n">f</span><span class="s1">&#39;`nmb_stages` of the model associated with element &#39;</span>
                <span class="n">f</span><span class="s1">&#39;`{objecttools.devicename(self)}`&#39;</span><span class="p">)</span>
        <span class="n">numericshape</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">numericshape</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">series</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InfoArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Internal time series data within an |InfoArray|.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">diskflag</span><span class="p">:</span>
            <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_int</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ramflag</span><span class="p">:</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_fastaccessattribute</span><span class="p">(</span><span class="s1">&#39;array&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;Sequence {objecttools.devicephrase(self)} is not &#39;</span>
                <span class="n">f</span><span class="s1">&#39;requested to make any internal data available.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">InfoArray</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unmodified&#39;</span><span class="p">})</span>

    <span class="nd">@series</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="n">series</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seriesshape</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">diskflag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_int</span><span class="p">(</span><span class="n">series</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ramflag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__set_array</span><span class="p">(</span><span class="n">series</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;Sequence {objecttools.devicephrase(self)} is not &#39;</span>
                <span class="n">f</span><span class="s1">&#39;requested to make any internal data available.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_completeness</span><span class="p">()</span>

    <span class="nd">@series</span><span class="o">.</span><span class="n">deleter</span>
    <span class="k">def</span> <span class="nf">series</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">diskflag</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath_int</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ramflag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span><span class="s1">&#39;array&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<div class="viewcode-block" id="IOSequence.load_ext"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.IOSequence.load_ext">[docs]</a>    <span class="k">def</span> <span class="nf">load_ext</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Read the internal data from an external data file.</span>

<span class="sd">        Method |IOSequence.load_ext| only calls method</span>
<span class="sd">        |SequenceManager.load_file| of class |SequenceManager|</span>
<span class="sd">        passing itself as the only argument.  Hence, see the</span>
<span class="sd">        documentation on the class |SequenceManager| for further</span>
<span class="sd">        information.  The following example only shows the error</span>
<span class="sd">        messages when |SequenceManager.load_file| is missing</span>
<span class="sd">        due to incomplete project configurations:</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">            &gt;&gt;&gt; del pub.sequencemanager</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.sequencetools import ModelSequence</span>
<span class="sd">        &gt;&gt;&gt; ModelSequence(None).load_ext()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: While trying to load the external time \</span>
<span class="sd">series data of `modelsequence`, the following error occurred: \</span>
<span class="sd">Attribute sequencemanager of module `pub` is not defined at the moment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sequencemanager</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">sequencemanager</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;While trying to load the external time series &#39;</span>
                <span class="n">f</span><span class="s1">&#39;data of {objecttools.devicephrase(self)}&#39;</span><span class="p">)</span>
        <span class="n">sequencemanager</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="IOSequence.adjust_series"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.IOSequence.adjust_series">[docs]</a>    <span class="k">def</span> <span class="nf">adjust_series</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">timegrid_data</span><span class="p">:</span> <span class="s1">&#39;timetools.Timegrid&#39;</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> \
            <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Adjust a time series to the current initialisation period.</span>

<span class="sd">        Note that, in most *HydPy* applications, method</span>
<span class="sd">        |IOSequence.adjust_series| is called by other methods related</span>
<span class="sd">        to reading data from files and does not need to be called by</span>
<span class="sd">        the user directly.  If you want to call it directly for some</span>
<span class="sd">        reasons, you need to make sure that the shape of the given</span>
<span class="sd">        |numpy| |numpy.ndarray| fits the given |Timegrid| object.</span>

<span class="sd">        Often, time series data available in (external) data files</span>
<span class="sd">        covers a longer period than required for an actual simulation</span>
<span class="sd">        run.  Method |IOSequence.adjust_series| selects the relevant</span>
<span class="sd">        data by comparing the initialisation |Timegrid| available in</span>
<span class="sd">        module |pub| and the given &quot;data&quot; |Timegrid| object.  We</span>
<span class="sd">        explain this behaviour by using the `LahnH` example project</span>
<span class="sd">        and focussing on the |Obs| sequence of |Node| `dill`:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_2</span>
<span class="sd">        &gt;&gt;&gt; hp, pub, TestIO = prepare_full_example_2()</span>
<span class="sd">        &gt;&gt;&gt; obs = hp.nodes.dill.sequences.obs</span>

<span class="sd">        With identical initialisation and data time grids, method</span>
<span class="sd">        |IOSequence.adjust_series| returns the given data completely:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Timegrid</span>
<span class="sd">        &gt;&gt;&gt; import numpy</span>
<span class="sd">        &gt;&gt;&gt; with TestIO(), pub.options.checkseries(False):</span>
<span class="sd">        ...     obs.adjust_series(Timegrid(&#39;1996-01-01&#39;, &#39;1996-01-05&#39;, &#39;1d&#39;),</span>
<span class="sd">        ...                       numpy.arange(4, dtype=float))</span>
<span class="sd">        array([ 0.,  1.,  2.,  3.])</span>

<span class="sd">        For &quot;too long&quot; available data, it only returns the relevant one:</span>

<span class="sd">        &gt;&gt;&gt; with TestIO(), pub.options.checkseries(False):</span>
<span class="sd">        ...     obs.adjust_series(Timegrid(&#39;1995-12-31&#39;, &#39;1996-01-07&#39;, &#39;1d&#39;),</span>
<span class="sd">        ...                       numpy.arange(7, dtype=float))</span>
<span class="sd">        array([ 1.,  2.,  3.,  4.])</span>

<span class="sd">        For &quot;too short&quot; available data, the behaviour differs depending</span>
<span class="sd">        on option |Options.checkseries|.  With |Options.checkseries| being</span>
<span class="sd">        enabled, method |IOSequence.adjust_series| raises a |RuntimeError|.</span>
<span class="sd">        With |Options.checkseries| being disabled, it extends the given</span>
<span class="sd">        array with |numpy.nan| values (using method</span>
<span class="sd">        |IOSequence.adjust_short_series|):</span>

<span class="sd">        &gt;&gt;&gt; with TestIO(), pub.options.checkseries(True):</span>
<span class="sd">        ...     obs.adjust_series(Timegrid(&#39;1996-01-02&#39;, &#39;1996-01-04&#39;, &#39;1d&#39;),</span>
<span class="sd">        ...                       numpy.zeros((3,)))   # doctest: +ELLIPSIS</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: For sequence `obs` of node `dill` the initialisation \</span>
<span class="sd">time grid (Timegrid(&#39;1996-01-01 00:00:00&#39;, &#39;1996-01-05 00:00:00&#39;, &#39;1d&#39;)) \</span>
<span class="sd">does not define a subset of the time grid of the external \</span>
<span class="sd">data file `...dill_obs_q.asc` \</span>
<span class="sd">(Timegrid(&#39;1996-01-02 00:00:00&#39;, &#39;1996-01-04 00:00:00&#39;, &#39;1d&#39;)).</span>

<span class="sd">        &gt;&gt;&gt; with TestIO(), pub.options.checkseries(False):</span>
<span class="sd">        ...     obs.adjust_series(Timegrid(&#39;1996-01-02&#39;, &#39;1996-01-04&#39;, &#39;1d&#39;),</span>
<span class="sd">        ...                       numpy.zeros((2,)))</span>
<span class="sd">        array([ nan,   0.,   0.,  nan])</span>

<span class="sd">        Additional checks raise errors in case of non-matching shapes</span>
<span class="sd">        or time information:</span>

<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     obs.adjust_series(Timegrid(&#39;1996-01-01&#39;, &#39;1996-01-05&#39;, &#39;1d&#39;),</span>
<span class="sd">        ...                       numpy.zeros((5, 2)))   # doctest: +ELLIPSIS</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: The shape of sequence `obs` of node `dill` is `()` but \</span>
<span class="sd">according to the external data file `...dill_obs_q.asc` it should be `(2,)`.</span>

<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     obs.adjust_series(Timegrid(&#39;1996-01-01&#39;, &#39;1996-01-05&#39;, &#39;1h&#39;),</span>
<span class="sd">        ...                       numpy.zeros((24*5,)))   # doctest: +ELLIPSIS</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: According to external data file `...dill_obs_q.asc`, \</span>
<span class="sd">the date time step of sequence `obs` of node `dill` is `1h` but the actual \</span>
<span class="sd">simulation time step is `1d`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;The shape of sequence {objecttools.devicephrase(self)} &#39;</span>
                <span class="n">f</span><span class="s1">&#39;is `</span><span class="si">{self.shape}</span><span class="s1">` but according to the external data file &#39;</span>
                <span class="n">f</span><span class="s1">&#39;`</span><span class="si">{self.filepath_ext}</span><span class="s1">` it should be `</span><span class="si">{values.shape[1:]}</span><span class="s1">`.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">timegrids</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">stepsize</span> <span class="o">!=</span> <span class="n">timegrid_data</span><span class="o">.</span><span class="n">stepsize</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;According to external data file `</span><span class="si">{self.filepath_ext}</span><span class="s1">`, &#39;</span>
                <span class="n">f</span><span class="s1">&#39;the date time step of sequence &#39;</span>
                <span class="n">f</span><span class="s1">&#39;{objecttools.devicephrase(self)} is &#39;</span>
                <span class="n">f</span><span class="s1">&#39;`</span><span class="si">{timegrid_data.stepsize}</span><span class="s1">` but the actual simulation &#39;</span>
                <span class="n">f</span><span class="s1">&#39;time step is `</span><span class="si">{hydpy.pub.timegrids.init.stepsize}</span><span class="s1">`.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">timegrids</span><span class="o">.</span><span class="n">init</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">timegrid_data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">checkseries</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="n">f</span><span class="s1">&#39;For sequence {objecttools.devicephrase(self)} the &#39;</span>
                    <span class="n">f</span><span class="s1">&#39;initialisation time grid (</span><span class="si">{hydpy.pub.timegrids.init}</span><span class="s1">) &#39;</span>
                    <span class="n">f</span><span class="s1">&#39;does not define a subset of the time grid of the &#39;</span>
                    <span class="n">f</span><span class="s1">&#39;external data file `</span><span class="si">{self.filepath_ext}</span><span class="s1">` &#39;</span>
                    <span class="n">f</span><span class="s1">&#39;(</span><span class="si">{timegrid_data}</span><span class="s1">).&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjust_short_series</span><span class="p">(</span><span class="n">timegrid_data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
        <span class="n">idx1</span> <span class="o">=</span> <span class="n">timegrid_data</span><span class="p">[</span><span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">timegrids</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">firstdate</span><span class="p">]</span>
        <span class="n">idx2</span> <span class="o">=</span> <span class="n">timegrid_data</span><span class="p">[</span><span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">timegrids</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">lastdate</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">values</span><span class="p">[</span><span class="n">idx1</span><span class="p">:</span><span class="n">idx2</span><span class="p">]</span></div>

<div class="viewcode-block" id="IOSequence.adjust_short_series"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.IOSequence.adjust_short_series">[docs]</a>    <span class="k">def</span> <span class="nf">adjust_short_series</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">timegrid</span><span class="p">:</span> <span class="s1">&#39;timetools.Timegrid&#39;</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> \
            <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Adjust a short time series to a longer time grid.</span>

<span class="sd">        Mostly, time series data to be read from external data files</span>
<span class="sd">        should span (at least) the whole initialization period of a</span>
<span class="sd">        *HydPy* project.  However, for some variables which are only used</span>
<span class="sd">        for comparison (e.g. observed runoff used for calibration),</span>
<span class="sd">        incomplete time series might also be helpful.  Method</span>
<span class="sd">        |IOSequence.adjust_short_series| adjusts such incomplete series</span>
<span class="sd">        to the public initialization time grid stored in module |pub|.</span>
<span class="sd">        It is automatically called in method |IOSequence.adjust_series|</span>
<span class="sd">        when necessary provided that the option |Options.checkseries|</span>
<span class="sd">        is disabled.</span>

<span class="sd">        Assume the initialization period of a HydPy project spans five days:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &#39;2000.01.10&#39;, &#39;2000.01.15&#39;, &#39;1d&#39;</span>

<span class="sd">        Prepare a node series object for observational data:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.sequencetools import Obs</span>
<span class="sd">        &gt;&gt;&gt; obs = Obs(None)</span>

<span class="sd">        Prepare a test function that expects the time grid of the</span>
<span class="sd">        data and the data itself, which returns the adjusted array</span>
<span class="sd">        through calling method |IOSequence.adjust_short_series|:</span>

<span class="sd">        &gt;&gt;&gt; import numpy</span>
<span class="sd">        &gt;&gt;&gt; def test(timegrid):</span>
<span class="sd">        ...     values = numpy.ones(len(timegrid))</span>
<span class="sd">        ...     return obs.adjust_short_series(timegrid, values)</span>

<span class="sd">        The following calls to the test function show the arrays</span>
<span class="sd">        returned for different kinds of misalignments:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Timegrid</span>
<span class="sd">        &gt;&gt;&gt; test(Timegrid(&#39;2000.01.05&#39;, &#39;2000.01.20&#39;, &#39;1d&#39;))</span>
<span class="sd">        array([ 1.,  1.,  1.,  1.,  1.])</span>
<span class="sd">        &gt;&gt;&gt; test(Timegrid(&#39;2000.01.12&#39;, &#39;2000.01.15&#39;, &#39;1d&#39;))</span>
<span class="sd">        array([ nan,  nan,   1.,   1.,   1.])</span>
<span class="sd">        &gt;&gt;&gt; test(Timegrid(&#39;2000.01.12&#39;, &#39;2000.01.17&#39;, &#39;1d&#39;))</span>
<span class="sd">        array([ nan,  nan,   1.,   1.,   1.])</span>
<span class="sd">        &gt;&gt;&gt; test(Timegrid(&#39;2000.01.10&#39;, &#39;2000.01.13&#39;, &#39;1d&#39;))</span>
<span class="sd">        array([  1.,   1.,   1.,  nan,  nan])</span>
<span class="sd">        &gt;&gt;&gt; test(Timegrid(&#39;2000.01.08&#39;, &#39;2000.01.13&#39;, &#39;1d&#39;))</span>
<span class="sd">        array([  1.,   1.,   1.,  nan,  nan])</span>
<span class="sd">        &gt;&gt;&gt; test(Timegrid(&#39;2000.01.12&#39;, &#39;2000.01.13&#39;, &#39;1d&#39;))</span>
<span class="sd">        array([ nan,  nan,   1.,  nan,  nan])</span>
<span class="sd">        &gt;&gt;&gt; test(Timegrid(&#39;2000.01.05&#39;, &#39;2000.01.10&#39;, &#39;1d&#39;))</span>
<span class="sd">        array([ nan,  nan,  nan,  nan,  nan])</span>
<span class="sd">        &gt;&gt;&gt; test(Timegrid(&#39;2000.01.05&#39;, &#39;2000.01.08&#39;, &#39;1d&#39;))</span>
<span class="sd">        array([ nan,  nan,  nan,  nan,  nan])</span>
<span class="sd">        &gt;&gt;&gt; test(Timegrid(&#39;2000.01.15&#39;, &#39;2000.01.18&#39;, &#39;1d&#39;))</span>
<span class="sd">        array([ nan,  nan,  nan,  nan,  nan])</span>
<span class="sd">        &gt;&gt;&gt; test(Timegrid(&#39;2000.01.16&#39;, &#39;2000.01.18&#39;, &#39;1d&#39;))</span>
<span class="sd">        array([ nan,  nan,  nan,  nan,  nan])</span>

<span class="sd">        After enabling option |Options.usedefaultvalues|, the missing</span>
<span class="sd">        values are initialised with zero instead of nan:</span>

<span class="sd">        &gt;&gt;&gt; with pub.options.usedefaultvalues(True):</span>
<span class="sd">        ...     test(Timegrid(&#39;2000.01.12&#39;, &#39;2000.01.17&#39;, &#39;1d&#39;))</span>
<span class="sd">        array([ 0.,  0.,  1.,  1.,  1.])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">idxs</span> <span class="o">=</span> <span class="p">[</span><span class="n">timegrid</span><span class="p">[</span><span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">timegrids</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">firstdate</span><span class="p">],</span>
                <span class="n">timegrid</span><span class="p">[</span><span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">timegrids</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">lastdate</span><span class="p">]]</span>
        <span class="n">valcopy</span> <span class="o">=</span> <span class="n">values</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seriesshape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initinfo</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">len_</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">valcopy</span><span class="p">)</span>
        <span class="n">jdxs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idxs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">jdxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">idx</span> <span class="o">&lt;=</span> <span class="n">len_</span><span class="p">:</span>
                <span class="n">jdxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">jdxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">len_</span><span class="p">)</span>
        <span class="n">valcopy</span> <span class="o">=</span> <span class="n">valcopy</span><span class="p">[</span><span class="n">jdxs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">jdxs</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">zdx1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">idxs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">zdx2</span> <span class="o">=</span> <span class="n">zdx1</span><span class="o">+</span><span class="n">jdxs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">jdxs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">values</span><span class="p">[</span><span class="n">zdx1</span><span class="p">:</span><span class="n">zdx2</span><span class="p">]</span> <span class="o">=</span> <span class="n">valcopy</span>
        <span class="k">return</span> <span class="n">values</span></div>

<div class="viewcode-block" id="IOSequence.check_completeness"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.IOSequence.check_completeness">[docs]</a>    <span class="k">def</span> <span class="nf">check_completeness</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Raise a |RuntimeError| if the |IOSequence.series| contains at</span>
<span class="sd">        least one |numpy.nan| value and if the option |Options.checkseries|</span>
<span class="sd">        is enabled.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &#39;2000-01-01&#39;, &#39;2000-01-11&#39;, &#39;1d&#39;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core.sequencetools import ModelSequence, StateSequences</span>
<span class="sd">        &gt;&gt;&gt; class Seq(ModelSequence):</span>
<span class="sd">        ...     NDIM = 0</span>
<span class="sd">        &gt;&gt;&gt; class StateSequences(StateSequences):</span>
<span class="sd">        ...     CLASSES = (Seq,)</span>
<span class="sd">        &gt;&gt;&gt; seq = Seq(StateSequences(None))</span>
<span class="sd">        &gt;&gt;&gt; seq.__hydpy__connect_variable2subgroup__()</span>
<span class="sd">        &gt;&gt;&gt; seq.activate_ram()</span>
<span class="sd">        &gt;&gt;&gt; seq.check_completeness()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: The series array of sequence `seq` contains 10 nan values.</span>

<span class="sd">        &gt;&gt;&gt; seq.series = 1.0</span>
<span class="sd">        &gt;&gt;&gt; seq.check_completeness()</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; seq.series[3] = numpy.nan</span>
<span class="sd">        &gt;&gt;&gt; seq.check_completeness()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: The series array of sequence `seq` contains 1 nan value.</span>

<span class="sd">        &gt;&gt;&gt; with pub.options.checkseries(False):</span>
<span class="sd">        ...     seq.check_completeness()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">checkseries</span><span class="p">:</span>
            <span class="n">isnan</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">isnan</span><span class="p">):</span>
                <span class="n">nmb</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">isnan</span><span class="p">)</span>
                <span class="n">valuestring</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span> <span class="k">if</span> <span class="n">nmb</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;values&#39;</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="n">f</span><span class="s1">&#39;The series array of sequence &#39;</span>
                    <span class="n">f</span><span class="s1">&#39;{objecttools.devicephrase(self)} contains &#39;</span>
                    <span class="n">f</span><span class="s1">&#39;</span><span class="si">{nmb}</span><span class="s1"> nan </span><span class="si">{valuestring}</span><span class="s1">.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="IOSequence.save_ext"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.IOSequence.save_ext">[docs]</a>    <span class="k">def</span> <span class="nf">save_ext</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Write the internal data into an external data file.</span>

<span class="sd">        Method |IOSequence.save_ext| only calls method</span>
<span class="sd">        |SequenceManager.save_file| of class |SequenceManager|</span>
<span class="sd">        passing itself as the only argument.  Hence, see the</span>
<span class="sd">        documentation on class the |SequenceManager| for further</span>
<span class="sd">        information.  The following example only shows the error</span>
<span class="sd">        messages when |SequenceManager.save_file| is missing</span>
<span class="sd">        due to incomplete project configurations:</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">            &gt;&gt;&gt; del pub.sequencemanager</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.sequencetools import ModelSequence</span>
<span class="sd">        &gt;&gt;&gt; ModelSequence(None).save_ext()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: While trying to save the external time \</span>
<span class="sd">series data of `modelsequence`, the following error occurred: \</span>
<span class="sd">Attribute sequencemanager of module `pub` is not defined at the moment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sequencemanager</span> <span class="o">=</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">sequencemanager</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;While trying to save the external time series &#39;</span>
                <span class="n">f</span><span class="s1">&#39;data of {objecttools.devicephrase(self)}&#39;</span><span class="p">)</span>
        <span class="n">sequencemanager</span><span class="o">.</span><span class="n">save_file</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="IOSequence.save_mean"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.IOSequence.save_mean">[docs]</a>    <span class="k">def</span> <span class="nf">save_mean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Average the time series date with method |IOSequence.average_series|</span>
<span class="sd">        of class |IOSequence| and write the result to file using method</span>
<span class="sd">        |SequenceManager.save_file| of class |SequenceManager|.</span>

<span class="sd">        The main documentation on class |SequenceManager| provides some</span>
<span class="sd">        examples.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">InfoArray</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">average_series</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="n">info</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="n">args</span><span class="p">,</span>
                  <span class="s1">&#39;kwargs&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">})</span>
        <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">sequencemanager</span><span class="o">.</span><span class="n">save_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">array</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_load_int</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Load internal data from a file and return it.&quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath_int</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seriesshape</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">values</span>

    <span class="k">def</span> <span class="nf">_save_int</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">values</span><span class="o">.</span><span class="n">tofile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath_int</span><span class="p">)</span>

<div class="viewcode-block" id="IOSequence.average_series"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.IOSequence.average_series">[docs]</a>    <span class="k">def</span> <span class="nf">average_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InfoArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Average the actual time series of the |Variable| object for all</span>
<span class="sd">        time points.</span>

<span class="sd">        Method |IOSequence.average_series| works similarly as method</span>
<span class="sd">        |Variable.average_values| of class |Variable|, from which we</span>
<span class="sd">        borrow some examples. However, firstly, we have to prepare a</span>
<span class="sd">        |Timegrids| object to define the |IOSequence.series| length:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &#39;2000-01-01&#39;, &#39;2000-01-04&#39;, &#39;1d&#39;</span>

<span class="sd">        As shown for method |Variable.average_values|, for 0-dimensional</span>
<span class="sd">        |IOSequence| objects the result of method |IOSequence.average_series|</span>
<span class="sd">        equals |IOSequence.series| itself:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.sequencetools import ModelSequence, StateSequences</span>
<span class="sd">        &gt;&gt;&gt; class SoilMoisture(ModelSequence):</span>
<span class="sd">        ...     NDIM = 0</span>
<span class="sd">        &gt;&gt;&gt; class StateSequences(StateSequences):</span>
<span class="sd">        ...     CLASSES = (SoilMoisture,)</span>
<span class="sd">        &gt;&gt;&gt; sm = SoilMoisture(StateSequences(None))</span>
<span class="sd">        &gt;&gt;&gt; sm.__hydpy__connect_variable2subgroup__()</span>
<span class="sd">        &gt;&gt;&gt; sm.activate_ram()</span>
<span class="sd">        &gt;&gt;&gt; import numpy</span>
<span class="sd">        &gt;&gt;&gt; sm.series = numpy.array([190.0, 200.0, 210.0])</span>
<span class="sd">        &gt;&gt;&gt; sm.average_series()</span>
<span class="sd">        InfoArray([ 190.,  200.,  210.])</span>

<span class="sd">        For |IOSequence| objects with an increased dimensionality, we</span>
<span class="sd">        require a weighting parameter:</span>

<span class="sd">        &gt;&gt;&gt; SoilMoisture.NDIM = 1</span>
<span class="sd">        &gt;&gt;&gt; sm.shape = 3</span>
<span class="sd">        &gt;&gt;&gt; sm.activate_ram()</span>
<span class="sd">        &gt;&gt;&gt; sm.series = (</span>
<span class="sd">        ...     [190.0, 390.0, 490.0],</span>
<span class="sd">        ...     [200.0, 400.0, 500.0],</span>
<span class="sd">        ...     [210.0, 410.0, 510.0])</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core.parametertools import Parameter</span>
<span class="sd">        &gt;&gt;&gt; class Area(Parameter):</span>
<span class="sd">        ...     NDIM = 1</span>
<span class="sd">        ...     shape = (3,)</span>
<span class="sd">        ...     value = numpy.array([1.0, 1.0, 2.0])</span>
<span class="sd">        &gt;&gt;&gt; area = Area(None)</span>
<span class="sd">        &gt;&gt;&gt; SoilMoisture.refweights = property(lambda self: area)</span>
<span class="sd">        &gt;&gt;&gt; sm.average_series()</span>
<span class="sd">        InfoArray([ 390.,  400.,  410.])</span>

<span class="sd">        The documentation on method |Variable.average_values| provides</span>
<span class="sd">        many examples of how to use different masks in different ways.</span>
<span class="sd">        Here, we only show the results of method |IOSequence.average_series|</span>
<span class="sd">        for a mask selecting the first two entries, for a mask selecting</span>
<span class="sd">        no entry at all, and for an ill-defined mask:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.masktools import DefaultMask</span>
<span class="sd">        &gt;&gt;&gt; class Soil(DefaultMask):</span>
<span class="sd">        ...     @classmethod</span>
<span class="sd">        ...     def new(cls, variable, **kwargs):</span>
<span class="sd">        ...         return cls.array2mask(maskvalues)</span>
<span class="sd">        &gt;&gt;&gt; SoilMoisture.mask = Soil()</span>

<span class="sd">        &gt;&gt;&gt; maskvalues = [True, True, False]</span>
<span class="sd">        &gt;&gt;&gt; sm.average_series()</span>
<span class="sd">        InfoArray([ 290.,  300.,  310.])</span>

<span class="sd">        &gt;&gt;&gt; maskvalues = [False, False, False]</span>
<span class="sd">        &gt;&gt;&gt; sm.average_series()</span>
<span class="sd">        nan</span>

<span class="sd">        &gt;&gt;&gt; maskvalues = [True, True]</span>
<span class="sd">        &gt;&gt;&gt; sm.average_series()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        IndexError: While trying to calculate the mean value of the internal \</span>
<span class="sd">time series of sequence `soilmoisture`, the following error occurred: \</span>
<span class="sd">While trying to access the value(s) of variable `area` with key \</span>
<span class="sd">`[ True  True]`, the following error occurred: \</span>
<span class="sd">boolean index did not match indexed array along dimension 0; \</span>
<span class="sd">dimension is 3 but corresponding boolean dimension is 2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="p">:</span>
                <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_submask</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
                    <span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refweights</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
                    <span class="n">weights</span> <span class="o">/=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
                    <span class="n">series</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">[:,</span> <span class="n">mask</span><span class="p">]</span>
                    <span class="n">axes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
                    <span class="n">array</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="o">*</span><span class="n">series</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axes</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">return</span> <span class="n">InfoArray</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">})</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;While trying to calculate the mean value of the internal &#39;</span>
                <span class="n">f</span><span class="s1">&#39;time series of sequence {objecttools.devicephrase(self)}&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="IOSequence.aggregate_series"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.IOSequence.aggregate_series">[docs]</a>    <span class="k">def</span> <span class="nf">aggregate_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InfoArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Aggregate time series data based on the actual</span>
<span class="sd">        |FluxSequence.aggregation_ext| attribute of |IOSequence|</span>
<span class="sd">        subclasses.</span>

<span class="sd">        We prepare some nodes and elements with the help of</span>
<span class="sd">        method |prepare_io_example_1| and select a 1-dimensional</span>
<span class="sd">        flux sequence of type |lland_fluxes.NKor| as an example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_io_example_1</span>
<span class="sd">        &gt;&gt;&gt; nodes, elements = prepare_io_example_1()</span>
<span class="sd">        &gt;&gt;&gt; seq = elements.element3.model.sequences.fluxes.nkor</span>

<span class="sd">        If |FluxSequence.aggregation_ext| is `none`, the</span>
<span class="sd">        original time series values are returned:</span>

<span class="sd">        &gt;&gt;&gt; seq.aggregation_ext</span>
<span class="sd">        &#39;none&#39;</span>
<span class="sd">        &gt;&gt;&gt; seq.aggregate_series()</span>
<span class="sd">        InfoArray([[ 24.,  25.,  26.],</span>
<span class="sd">                   [ 27.,  28.,  29.],</span>
<span class="sd">                   [ 30.,  31.,  32.],</span>
<span class="sd">                   [ 33.,  34.,  35.]])</span>

<span class="sd">        If |FluxSequence.aggregation_ext| is `mean`, method</span>
<span class="sd">        |IOSequence.aggregate_series| is called:</span>

<span class="sd">        &gt;&gt;&gt; seq.aggregation_ext = &#39;mean&#39;</span>
<span class="sd">        &gt;&gt;&gt; seq.aggregate_series()</span>
<span class="sd">        InfoArray([ 25.,  28.,  31.,  34.])</span>

<span class="sd">        In case the state of the sequence is invalid:</span>

<span class="sd">        &gt;&gt;&gt; seq.aggregation_ext = &#39;nonexistent&#39;</span>
<span class="sd">        &gt;&gt;&gt; seq.aggregate_series()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: Unknown aggregation mode `nonexistent` for \</span>
<span class="sd">sequence `nkor` of element `element3`.</span>

<span class="sd">        The following technical test confirms the propr passing of</span>
<span class="sd">        all potential positional and keyword arguments</span>

<span class="sd">        &gt;&gt;&gt; seq.aggregation_ext = &#39;mean&#39;</span>
<span class="sd">        &gt;&gt;&gt; from unittest import mock</span>
<span class="sd">        &gt;&gt;&gt; seq.average_series = mock.MagicMock()</span>
<span class="sd">        &gt;&gt;&gt; _ = seq.aggregate_series(1, x=2)</span>
<span class="sd">        &gt;&gt;&gt; seq.average_series.assert_called_with(1, x=2)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregation_ext</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">series</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">average_series</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="n">f</span><span class="s1">&#39;Unknown aggregation mode `</span><span class="si">{mode}</span><span class="s1">` for &#39;</span>
            <span class="n">f</span><span class="s1">&#39;sequence {objecttools.devicephrase(self)}.&#39;</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">descr_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Description of the |Sequence| object and its context.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">descr_device</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Description of the |Device| object the |Sequence| object</span>
<span class="sd">        belongs to.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="ModelSequence"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.ModelSequence">[docs]</a><span class="k">class</span> <span class="nc">ModelSequence</span><span class="p">(</span><span class="n">IOSequence</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for sequences to be handled by |Model| objects.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">descr_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Description of the |ModelSequence| object itself and the</span>
<span class="sd">        |SubSequences| group it belongs to.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models import test_v1</span>
<span class="sd">        &gt;&gt;&gt; model = prepare_model(test_v1)</span>
<span class="sd">        &gt;&gt;&gt; model.sequences.fluxes.q.descr_sequence</span>
<span class="sd">        &#39;flux_q&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">f</span><span class="s1">&#39;{objecttools.classname(self.subseqs)[:-9].lower()}_</span><span class="si">{self.name}</span><span class="s1">&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">descr_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Description of the |Model| the |ModelSequence| object belongs to.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models import test, test_v1</span>
<span class="sd">        &gt;&gt;&gt; model = prepare_model(test)</span>
<span class="sd">        &gt;&gt;&gt; model.sequences.fluxes.q.descr_model</span>
<span class="sd">        &#39;test&#39;</span>
<span class="sd">        &gt;&gt;&gt; model = prepare_model(test_v1)</span>
<span class="sd">        &gt;&gt;&gt; model.sequences.fluxes.q.descr_model</span>
<span class="sd">        &#39;test_v1&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subseqs</span><span class="o">.</span><span class="n">seqs</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="vm">__module__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">descr_device</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Description of the |Element| object the |ModelSequence| object</span>
<span class="sd">        belongs to.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model, Element</span>
<span class="sd">        &gt;&gt;&gt; element = Element(&#39;test_element_1&#39;)</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.models import test_v1</span>
<span class="sd">        &gt;&gt;&gt; element.model = prepare_model(test_v1)</span>
<span class="sd">        &gt;&gt;&gt; element.model.sequences.fluxes.q.descr_device</span>
<span class="sd">        &#39;test_element_1&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subseqs</span><span class="o">.</span><span class="n">seqs</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">name</span></div>


<div class="viewcode-block" id="InputSequence"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.InputSequence">[docs]</a><span class="k">class</span> <span class="nc">InputSequence</span><span class="p">(</span><span class="n">ModelSequence</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for input sequences of |Model| objects.&quot;&quot;&quot;</span>

    <span class="n">filetype_ext</span> <span class="o">=</span> <span class="n">_FileType</span><span class="p">()</span>
    <span class="n">dirpath_ext</span> <span class="o">=</span> <span class="n">_DirPathProperty</span><span class="p">()</span>
    <span class="n">aggregation_ext</span> <span class="o">=</span> <span class="n">_AggregationProperty</span><span class="p">()</span>
    <span class="n">overwrite_ext</span> <span class="o">=</span> <span class="n">_OverwriteProperty</span><span class="p">()</span></div>


<div class="viewcode-block" id="FluxSequence"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.FluxSequence">[docs]</a><span class="k">class</span> <span class="nc">FluxSequence</span><span class="p">(</span><span class="n">ModelSequence</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for flux sequences of |Model| objects.&quot;&quot;&quot;</span>

    <span class="n">filetype_ext</span> <span class="o">=</span> <span class="n">_FileType</span><span class="p">()</span>
    <span class="n">dirpath_ext</span> <span class="o">=</span> <span class="n">_DirPathProperty</span><span class="p">()</span>
    <span class="n">aggregation_ext</span> <span class="o">=</span> <span class="n">_AggregationProperty</span><span class="p">()</span>
    <span class="n">overwrite_ext</span> <span class="o">=</span> <span class="n">_OverwriteProperty</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_finalise_connections</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_finalise_connections</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NUMERIC</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span> <span class="k">else</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numericshape</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span><span class="s1">&#39;points&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span><span class="s1">&#39;integrals&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span> <span class="k">else</span> <span class="mf">0.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__hydpy__get_shape__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;A tuple containing the actual lengths of all dimensions.</span>

<span class="sd">        |FluxSequence| objects come with some additional `fastaccess`</span>
<span class="sd">        attributes, which should be of interest for framework developers</span>
<span class="sd">        only.  However, model developers should note that we did</span>
<span class="sd">        implement only 0-dimensional |FluxSequence| subclasses with a</span>
<span class="sd">        |True| `NUMERIC` flag so far.  Hence, we still need to prove the</span>
<span class="sd">        complete functionality of our design of 1-dimensional |FluxSequence|</span>
<span class="sd">        subclasses with a |True| `NUMERIC` flag.</span>

<span class="sd">        One example of a 0-dimensional sequence is the `results` array,</span>
<span class="sd">        handling the (intermediate or  final) calculation results for</span>
<span class="sd">        flux sequence |dam_fluxes.Inflow| of the |dam| model:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model, print_values, pub</span>
<span class="sd">        &gt;&gt;&gt; model = prepare_model(&#39;dam_v001&#39;)</span>
<span class="sd">        &gt;&gt;&gt; inflow = model.sequences.fluxes.inflow</span>
<span class="sd">        &gt;&gt;&gt; print_values(inflow.fastaccess._inflow_results)</span>
<span class="sd">        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0</span>

<span class="sd">        We now show the still not thoroughly tested functionality</span>
<span class="sd">        of 1-dimensional numerical flux sequences by changing the</span>
<span class="sd">        dimensionality of class |dam_fluxes.Inflow| and working in</span>
<span class="sd">        pure Python mode.  Now, the `results` attribute is |None|</span>
<span class="sd">        initially, as property |IOSequence.numericshape| is unknown.</span>
<span class="sd">        However, setting the |FluxSequence.shape| attribute of</span>
<span class="sd">        |FluxSequence| objects prepares all &quot;fastaccess attributes&quot;</span>
<span class="sd">        automatically:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.dam.dam_fluxes import Inflow</span>
<span class="sd">        &gt;&gt;&gt; Inflow.NDIM = 1</span>
<span class="sd">        &gt;&gt;&gt; with pub.options.usecython(False):</span>
<span class="sd">        ...     model = prepare_model(&#39;dam_v001&#39;)</span>
<span class="sd">        &gt;&gt;&gt; inflow = model.sequences.fluxes.inflow</span>
<span class="sd">        &gt;&gt;&gt; inflow.fastaccess._inflow_results</span>

<span class="sd">        &gt;&gt;&gt; inflow.shape = (2,)</span>
<span class="sd">        &gt;&gt;&gt; inflow.shape</span>
<span class="sd">        (2,)</span>
<span class="sd">        &gt;&gt;&gt; inflow.fastaccess._inflow_results.shape</span>
<span class="sd">        (11, 2)</span>

<span class="sd">        &gt;&gt;&gt; Inflow.NDIM = 0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__hydpy__get_shape__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__hydpy__set_shape__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__hydpy__set_shape__</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">NUMERIC</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span>
                <span class="s1">&#39;points&#39;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numericshape</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span>
                <span class="s1">&#39;integrals&#39;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numericshape</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span>
                <span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numericshape</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span>
                <span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

    <span class="n">shape</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">fget</span><span class="o">=</span><span class="n">__hydpy__get_shape__</span><span class="p">,</span> <span class="n">fset</span><span class="o">=</span><span class="n">__hydpy__set_shape__</span><span class="p">)</span></div>


<div class="viewcode-block" id="ConditionSequence"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.ConditionSequence">[docs]</a><span class="k">class</span> <span class="nc">ConditionSequence</span><span class="p">(</span><span class="n">Sequence</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for |StateSequence| and |LogSequence|.</span>

<span class="sd">    Class |ConditionSequence| should not be subclassed by model</span>
<span class="sd">    developers directly.  Inherit from |StateSequence| or</span>
<span class="sd">    |LogSequence| instead.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_oldargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subvars</span><span class="p">:</span> <span class="n">SubSequences</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">subvars</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_oldargs</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The prefered way to pass values to |Sequence| instances within</span>
<span class="sd">        initial condition files.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trim</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_oldargs</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

<div class="viewcode-block" id="ConditionSequence.trim"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.ConditionSequence.trim">[docs]</a>    <span class="k">def</span> <span class="nf">trim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Apply |trim| of module |variabletools|.&quot;&quot;&quot;</span>
        <span class="n">variabletools</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span></div>

<div class="viewcode-block" id="ConditionSequence.reset"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.ConditionSequence.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset the value of the actual |StateSequence| or |LogSequence|</span>
<span class="sd">        object to the last value defined by &quot;calling&quot; the object.</span>

<span class="sd">        We use the |lland_v2| application model, which handles sequences</span>
<span class="sd">        derived from |StateSequence| (taking |lland_states.Inzp| as an</span>
<span class="sd">        example) and from |LogSequence| (taking |lland_logs.WET0| as an</span>
<span class="sd">        example):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model, pub</span>
<span class="sd">        &gt;&gt;&gt; model = prepare_model(&#39;lland_v2&#39;)</span>

<span class="sd">        After defining their shapes, both sequences contain |numpy.nan|</span>
<span class="sd">        values:</span>

<span class="sd">        &gt;&gt;&gt; inzp = model.sequences.states.inzp</span>
<span class="sd">        &gt;&gt;&gt; inzp.shape = (2,)</span>
<span class="sd">        &gt;&gt;&gt; inzp</span>
<span class="sd">        inzp(nan, nan)</span>
<span class="sd">        &gt;&gt;&gt; wet0 = model.sequences.logs.wet0</span>
<span class="sd">        &gt;&gt;&gt; wet0.shape = 2</span>
<span class="sd">        &gt;&gt;&gt; wet0</span>
<span class="sd">        wet0([[nan, nan]])</span>

<span class="sd">        Before &quot;calling&quot; the sequences, method |ConditionSequence.reset|</span>
<span class="sd">        does nothing:</span>

<span class="sd">        &gt;&gt;&gt; inzp.values = 0.0</span>
<span class="sd">        &gt;&gt;&gt; inzp.reset()</span>
<span class="sd">        &gt;&gt;&gt; inzp</span>
<span class="sd">        inzp(0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; wet0.values = 0.0</span>
<span class="sd">        &gt;&gt;&gt; wet0.reset()</span>
<span class="sd">        &gt;&gt;&gt; wet0</span>
<span class="sd">        wet0([[0.0, 0.0]])</span>

<span class="sd">        After &quot;calling&quot; the sequences, method |ConditionSequence.reset|</span>
<span class="sd">        reuses the respective arguments:</span>

<span class="sd">        &gt;&gt;&gt; with pub.options.warntrim(False):</span>
<span class="sd">        ...     inzp(0.0, 1.0)</span>
<span class="sd">        &gt;&gt;&gt; inzp.values = 0.0</span>
<span class="sd">        &gt;&gt;&gt; inzp</span>
<span class="sd">        inzp(0.0, 0.0)</span>
<span class="sd">        &gt;&gt;&gt; with pub.options.warntrim(False):</span>
<span class="sd">        ...     inzp.reset()</span>
<span class="sd">        &gt;&gt;&gt; inzp</span>
<span class="sd">        inzp(0.0, 1.0)</span>
<span class="sd">        &gt;&gt;&gt; wet0(1.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; wet0.values = 3.0</span>
<span class="sd">        &gt;&gt;&gt; wet0</span>
<span class="sd">        wet0([[3.0, 3.0]])</span>
<span class="sd">        &gt;&gt;&gt; wet0.reset()</span>
<span class="sd">        &gt;&gt;&gt; wet0</span>
<span class="sd">        wet0([[1.0, 2.0]])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oldargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_oldargs</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="StateSequence"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.StateSequence">[docs]</a><span class="k">class</span> <span class="nc">StateSequence</span><span class="p">(</span><span class="n">ConditionSequence</span><span class="p">,</span> <span class="n">ModelSequence</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for state sequences of |Model| objects.</span>

<span class="sd">    Each |StateSequence| object is capable in handling states at two</span>
<span class="sd">    different &quot;time points&quot;: at the beginning of a simulation step via</span>
<span class="sd">    property |StateSequence.old| and the end of a simulation step</span>
<span class="sd">    via property |StateSequence.new|.  These properties are reflected</span>
<span class="sd">    by two different `fastaccess` attributes.  `fastaccess_new` is</span>
<span class="sd">    an alias for the standard `fastaccess` attribute storing the</span>
<span class="sd">    customary information. `fastaccess_old` is an additional feature</span>
<span class="sd">    for storing the supplemental information.</span>

<span class="sd">    We demonstrate the above explanations using state sequence</span>
<span class="sd">    |hland_states.SM| of base model |hland_v1| with a shape of two:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import prepare_model</span>
<span class="sd">    &gt;&gt;&gt; model = prepare_model(&#39;hland&#39;, &#39;1d&#39;)</span>
<span class="sd">    &gt;&gt;&gt; model.parameters.control.fc.shape = (2,)</span>
<span class="sd">    &gt;&gt;&gt; model.parameters.control.fc = 100.0</span>
<span class="sd">    &gt;&gt;&gt; sm = model.sequences.states.sm</span>
<span class="sd">    &gt;&gt;&gt; sm.shape = (2,)</span>

<span class="sd">    Initially, no values are available at all:</span>

<span class="sd">    &gt;&gt;&gt; sm</span>
<span class="sd">    sm(nan, nan)</span>
<span class="sd">    &gt;&gt;&gt; sm.values</span>
<span class="sd">    array([ nan,  nan])</span>
<span class="sd">    &gt;&gt;&gt; sm.new</span>
<span class="sd">    array([ nan,  nan])</span>
<span class="sd">    &gt;&gt;&gt; sm.old</span>
<span class="sd">    array([ nan,  nan])</span>

<span class="sd">    The typical way to define state values, especially within condition</span>
<span class="sd">    files, is to &quot;call&quot; state sequence objects, which sets both the</span>
<span class="sd">    &quot;old&quot; and the &quot;new&quot; states to the given value(s):</span>

<span class="sd">    &gt;&gt;&gt; sm(1.0)</span>
<span class="sd">    &gt;&gt;&gt; sm.values</span>
<span class="sd">    array([ 1.,  1.])</span>
<span class="sd">    &gt;&gt;&gt; sm.new</span>
<span class="sd">    array([ 1.,  1.])</span>
<span class="sd">    &gt;&gt;&gt; sm.old</span>
<span class="sd">    array([ 1.,  1.])</span>

<span class="sd">    Alternatively, one can assign values to property |StateSequence.new|</span>
<span class="sd">    or property |StateSequence.old| (note that using |StateSequence.new|</span>
<span class="sd">    is identical with using the |Variable.value| property):</span>

<span class="sd">    &gt;&gt;&gt; sm.new = 2.0, 3.0</span>
<span class="sd">    &gt;&gt;&gt; sm</span>
<span class="sd">    sm(2.0, 3.0)</span>
<span class="sd">    &gt;&gt;&gt; sm.values</span>
<span class="sd">    array([ 2.,  3.])</span>
<span class="sd">    &gt;&gt;&gt; sm.new</span>
<span class="sd">    array([ 2.,  3.])</span>
<span class="sd">    &gt;&gt;&gt; sm.old</span>
<span class="sd">    array([ 1.,  1.])</span>

<span class="sd">    &gt;&gt;&gt; sm.old = 200.0</span>
<span class="sd">    &gt;&gt;&gt; sm</span>
<span class="sd">    sm(2.0, 3.0)</span>
<span class="sd">    &gt;&gt;&gt; sm.values</span>
<span class="sd">    array([ 2.,  3.])</span>
<span class="sd">    &gt;&gt;&gt; sm.new</span>
<span class="sd">    array([ 2.,  3.])</span>
<span class="sd">    &gt;&gt;&gt; sm.old</span>
<span class="sd">    array([ 200.,  200.])</span>

<span class="sd">    Assigning problematic values to property |StateSequence.old| results</span>
<span class="sd">    in very similar error messages as assigning problematic values to</span>
<span class="sd">    property |Variable.value|:</span>

<span class="sd">    &gt;&gt;&gt; sm.old = 1.0, 2.0, 3.0</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: While trying to set the old value(s) of state sequence `sm`, \</span>
<span class="sd">the following error occurred: While trying to convert the value(s) \</span>
<span class="sd">`(1.0, 2.0, 3.0)` to a numpy ndarray with shape `(2,)` and type `float`, \</span>
<span class="sd">the following error occurred: could not broadcast input array from \</span>
<span class="sd">shape (3) into shape (2)</span>

<span class="sd">    Just for completeness:  Method |StateSequence.new2old| effectively</span>
<span class="sd">    takes the new values as old ones, but more efficiently than using</span>
<span class="sd">    the properties |StateSequence.new| and |StateSequence.old|,  as it</span>
<span class="sd">    used during simulation runs (in fact, the Python method</span>
<span class="sd">    |StateSequence.new2old| is usually replaced by model specific,</span>
<span class="sd">    cythonized version when working in Cython mode):</span>

<span class="sd">    &gt;&gt;&gt; sm.new2old()</span>
<span class="sd">    &gt;&gt;&gt; sm.values</span>
<span class="sd">    array([ 2.,  3.])</span>
<span class="sd">    &gt;&gt;&gt; sm.new</span>
<span class="sd">    array([ 2.,  3.])</span>
<span class="sd">    &gt;&gt;&gt; sm.old</span>
<span class="sd">    array([ 2.,  3.])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">NOT_DEEPCOPYABLE_MEMBERS</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;subseqs&#39;</span><span class="p">,</span> <span class="s1">&#39;fastaccess_old&#39;</span><span class="p">,</span> <span class="s1">&#39;fastaccess_new&#39;</span><span class="p">)</span>

    <span class="n">filetype_ext</span> <span class="o">=</span> <span class="n">_FileType</span><span class="p">()</span>
    <span class="n">dirpath_ext</span> <span class="o">=</span> <span class="n">_DirPathProperty</span><span class="p">()</span>
    <span class="n">aggregation_ext</span> <span class="o">=</span> <span class="n">_AggregationProperty</span><span class="p">()</span>
    <span class="n">overwrite_ext</span> <span class="o">=</span> <span class="n">_OverwriteProperty</span><span class="p">()</span>

    <span class="n">fastaccess_new</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s1">&#39;FastAccessModelSequence&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;typingtools.FastAccessModelSequenceProtocol&#39;</span><span class="p">]</span>
    <span class="n">fastaccess_old</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s1">&#39;FastAccessModelSequence&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;typingtools.FastAccessModelSequenceProtocol&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The prefered way to pass values to |Sequence| instances within</span>
<span class="sd">        initial condition files.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new2old</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_finalise_connections</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_finalise_connections</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NUMERIC</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span> <span class="k">else</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numericshape</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span><span class="s1">&#39;points&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess_old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subseqs</span><span class="o">.</span><span class="n">fastaccess_old</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subseqs</span><span class="o">.</span><span class="n">fastaccess_new</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess_old</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess_old</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__hydpy__get_shape__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;A tuple containing the actual lengths of all dimensions.</span>

<span class="sd">        |StateSequence| objects come with some additional `fastaccess`</span>
<span class="sd">        attributes, which should be of interest for framework developers</span>
<span class="sd">        only.  However, model developers should note that we did</span>
<span class="sd">        implement only 1-dimensional |StateSequence| subclasses with a</span>
<span class="sd">        |True| `NUMERIC` flag so far.  We still need to prove the</span>
<span class="sd">        complete functionality of our design of 1-dimensional</span>
<span class="sd">        |StateSequence| subclasses with a |True| `NUMERIC` flag.</span>

<span class="sd">        One example of a 0-dimensional sequence is the `results` array,</span>
<span class="sd">        handling the (intermediate or  final) calculation results for</span>
<span class="sd">        state sequence |dam_states.WaterVolume| of the |dam| model:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import prepare_model, print_values, pub</span>
<span class="sd">        &gt;&gt;&gt; model = prepare_model(&#39;dam_v001&#39;)</span>
<span class="sd">        &gt;&gt;&gt; watervolume = model.sequences.states.watervolume</span>
<span class="sd">        &gt;&gt;&gt; print_values(watervolume.fastaccess._watervolume_results)</span>
<span class="sd">        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0</span>

<span class="sd">        We now show the still not thoroughly tested functionality</span>
<span class="sd">        of 1-dimensional numerical state sequences by changing the</span>
<span class="sd">        dimensionality of class |dam_states.WaterVolume| and working in</span>
<span class="sd">        pure Python mode.  Now, the `results` attribute is |None|</span>
<span class="sd">        initially, as property |IOSequence.numericshape| is unknown.</span>
<span class="sd">        However, setting the |StateSequence.shape| attribute of</span>
<span class="sd">        |StateSequence| objects prepares all &quot;fastaccess attributes&quot;</span>
<span class="sd">        automatically:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.models.dam.dam_states import WaterVolume</span>
<span class="sd">        &gt;&gt;&gt; WaterVolume.NDIM = 1</span>
<span class="sd">        &gt;&gt;&gt; with pub.options.usecython(False):</span>
<span class="sd">        ...     model = prepare_model(&#39;dam_v001&#39;)</span>
<span class="sd">        &gt;&gt;&gt; watervolume = model.sequences.states.watervolume</span>
<span class="sd">        &gt;&gt;&gt; watervolume.fastaccess._watervolume_results</span>

<span class="sd">        &gt;&gt;&gt; watervolume.shape = (2,)</span>
<span class="sd">        &gt;&gt;&gt; watervolume.shape</span>
<span class="sd">        (2,)</span>
<span class="sd">        &gt;&gt;&gt; watervolume.fastaccess._watervolume_results.shape</span>
<span class="sd">        (11, 2)</span>

<span class="sd">        &gt;&gt;&gt; WaterVolume.NDIM = 0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__hydpy__get_shape__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__hydpy__set_shape__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__hydpy__set_shape__</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess_old</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NUMERIC</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span>
                    <span class="s1">&#39;points&#39;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numericshape</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span>
                    <span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numericshape</span><span class="p">))</span>

    <span class="n">shape</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">fget</span><span class="o">=</span><span class="n">__hydpy__get_shape__</span><span class="p">,</span> <span class="n">fset</span><span class="o">=</span><span class="n">__hydpy__set_shape__</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;State(s) after calling a |Model| calculation method. (Alias</span>
<span class="sd">        for property |Variable.value|).</span>

<span class="sd">        Property |StateSequence.new| handles, in contrast to property</span>
<span class="sd">        |StateSequence.old|, the newly calculated state values during</span>
<span class="sd">        each simulation step.  It supports testing and debugging of</span>
<span class="sd">        individual |Model| methods but istypically irrelevant when</span>
<span class="sd">        scripting *HydPy* workflows.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__hydpy__get_value__</span><span class="p">()</span>

    <span class="nd">@new</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__hydpy__set_value__</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">old</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;State(s) before calling a |Model| calculation method.</span>

<span class="sd">        Note the similarity to property |StateSequence.new|. However,</span>
<span class="sd">        property |StateSequence.old| references the initial states</span>
<span class="sd">        of the respective simulation step, which should not be changed</span>
<span class="sd">        by |Model| calculation methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_getvalue</span><span class="p">(</span>
            <span class="kc">True</span><span class="p">,</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess_old</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

    <span class="nd">@old</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">old</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess_old</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_setvalue</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;While trying to set the old value(s) of state sequence &#39;</span>
                <span class="n">f</span><span class="s1">&#39;{objecttools.devicephrase(self)}&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="StateSequence.new2old"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.StateSequence.new2old">[docs]</a>    <span class="k">def</span> <span class="nf">new2old</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Assign the |StateSequence.new| state values to the</span>
<span class="sd">        |StateSequence.old| values.</span>

<span class="sd">        See the main documentation on class |StateSequence| for further</span>
<span class="sd">        information.</span>

<span class="sd">        Note that method |StateSequence.new2old| is replaced by a model</span>
<span class="sd">        specific, cythonized method when working in Cython mode.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">old</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new</span><span class="p">[:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new</span></div></div>


<div class="viewcode-block" id="LogSequence"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.LogSequence">[docs]</a><span class="k">class</span> <span class="nc">LogSequence</span><span class="p">(</span><span class="n">ConditionSequence</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for logging sequences of |Model| objects.</span>

<span class="sd">    Class |LogSequence| serves similar purposes as class |StateSequence|,</span>
<span class="sd">    but is less strict in its assumptions.  While |StateSequence| objects</span>
<span class="sd">    always handle two states (the |StateSequence.old| and the</span>
<span class="sd">    |StateSequence.new| one), |LogSequence| objects are supposed to</span>
<span class="sd">    remember an arbitrary or sequence-specific number of values, which</span>
<span class="sd">    can be state values but for example also flux values.  A typical</span>
<span class="sd">    use case is to store &quot;old&quot; values of effective precipitation to</span>
<span class="sd">    calculate &quot;new&quot; values of direct discharge using the unit hydrograph</span>
<span class="sd">    concept in later simulation steps.</span>

<span class="sd">    It is up to the model developer to make sure that a |LogSequence|</span>
<span class="sd">    subclass has the right dimensionality and shape to store the required</span>
<span class="sd">    information.  By convention, the &quot;memory&quot; of each |LogSequence|</span>
<span class="sd">    should be placed on the first axis for non-scalar properties.</span>

<span class="sd">    As |StateSequence| objects, |LogSequence| objects store relevant</span>
<span class="sd">    information to start a new simulation run where another one has</span>
<span class="sd">    ended, and are thus written into and read from condition files.</span>
<span class="sd">    &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="AideSequence"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.AideSequence">[docs]</a><span class="k">class</span> <span class="nc">AideSequence</span><span class="p">(</span><span class="n">Sequence</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for aide sequences of |Model| objects.</span>

<span class="sd">    Aide sequences store data that is of importance only temporarily but</span>
<span class="sd">    must be shared by different calculation methods of a |Model| object.</span>
<span class="sd">    &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="LinkSequence"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.LinkSequence">[docs]</a><span class="k">class</span> <span class="nc">LinkSequence</span><span class="p">(</span><span class="n">Sequence</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for link sequences of |Model| objects.</span>

<span class="sd">    |LinkSequence| objects do not handle values themselves.</span>
<span class="sd">    Instead, they point to the values handled |NodeSequence| objects,</span>
<span class="sd">    using the functionalities provided by the Cython module</span>
<span class="sd">    |pointerutils|.  Multiple |LinkSequence| objects of different</span>
<span class="sd">    application models can query and modify the same |NodeSequence|</span>
<span class="sd">    values, allowing different |Model| objects to share information</span>
<span class="sd">    and interact with each other.</span>

<span class="sd">    A note for developers: |LinkSequence| subclasses must be either</span>
<span class="sd">    0-dimensional or 1-dimensional.</span>

<span class="sd">    Users might encounter the following exception, which is a safety</span>
<span class="sd">    measure to --- as the error message suggests --- prevent from</span>
<span class="sd">    segmentation faults:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.core.sequencetools import LinkSequence</span>
<span class="sd">    &gt;&gt;&gt; seq = LinkSequence(None)</span>
<span class="sd">    &gt;&gt;&gt; seq</span>
<span class="sd">    linksequence(?)</span>
<span class="sd">    &gt;&gt;&gt; seq.value</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeError: While trying to query the value(s) of link sequence \</span>
<span class="sd">`linksequence` of element `?`, the following error occurred: \</span>
<span class="sd">Proper connections are missing (which could result in segmentation faults \</span>
<span class="sd">when using it, so please be careful).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fastaccess</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s1">&#39;FastAccessModelSequence&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;typingtools.FastAccessLinkSequenceProtocol&#39;</span><span class="p">]</span>

    <span class="n">__isready</span><span class="p">:</span> <span class="nb">bool</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subvars</span><span class="p">:</span> <span class="n">SubSequences</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__isready</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">subvars</span><span class="p">)</span>

<div class="viewcode-block" id="LinkSequence.set_pointer"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.LinkSequence.set_pointer">[docs]</a>    <span class="k">def</span> <span class="nf">set_pointer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">double</span><span class="p">:</span> <span class="n">pointerutils</span><span class="o">.</span><span class="n">Double</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Prepare a pointer referencing the given |Double| object.</span>

<span class="sd">        For 1-dimensional sequence objects, one also needs to specify</span>
<span class="sd">        the relevant index position of the pointer via argument `idx`.</span>

<span class="sd">        Method |LinkSequence.set_pointer| should be of relevance for</span>
<span class="sd">        framework developers and eventually for some model developers</span>
<span class="sd">        only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pdouble</span> <span class="o">=</span> <span class="n">pointerutils</span><span class="o">.</span><span class="n">PDouble</span><span class="p">(</span><span class="n">double</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="n">FastAccessModelSequence</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">pdouble</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="o">.</span><span class="n">set_pointer0d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">pdouble</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="n">FastAccessModelSequence</span><span class="p">):</span>
                <span class="n">ppdouble</span><span class="p">:</span> <span class="n">pointerutils</span><span class="o">.</span><span class="n">PPDouble</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">ppdouble</span><span class="o">.</span><span class="n">set_pointer</span><span class="p">(</span><span class="n">double</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="o">.</span><span class="n">set_pointer1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">pdouble</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__isready</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">_finalise_connections</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">pointerutils</span><span class="o">.</span><span class="n">PPDouble</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__hydpy__get_value__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The actual value(s) the |LinkSequence| object is pointing at.</span>

<span class="sd">        Changing a |LinkSequence.value| of a |LinkSequence| object seems</span>
<span class="sd">        very much like changing a |LinkSequence.value| of any other</span>
<span class="sd">        |Variable| object.  However, be aware that you are changing a</span>
<span class="sd">        value that is handled by a |NodeSequence| object.  We demonstrate</span>
<span class="sd">        this by using the `LahnH` example project through invoking</span>
<span class="sd">        function |prepare_full_example_2|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_2</span>
<span class="sd">        &gt;&gt;&gt; hp, pub, TestIO = prepare_full_example_2()</span>

<span class="sd">        We focus on the |hstream_v1| application model `stream_lahn_1_lahn_2`</span>
<span class="sd">        routing inflow from node `lahn_1` to node `lahn_2`:</span>

<span class="sd">        &gt;&gt;&gt; model = hp.elements.stream_lahn_1_lahn_2.model</span>

<span class="sd">        The first example shows that the 0-dimensional outlet sequence</span>
<span class="sd">        |hstream_outlets.Q| points to the |Sim| sequence of node `lahn_2`:</span>

<span class="sd">        &gt;&gt;&gt; model.sequences.outlets.q</span>
<span class="sd">        q(0.0)</span>
<span class="sd">        &gt;&gt;&gt; hp.nodes.lahn_2.sequences.sim = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.sequences.outlets.q</span>
<span class="sd">        q(1.0)</span>
<span class="sd">        &gt;&gt;&gt; model.sequences.outlets.q(2.0)</span>
<span class="sd">        &gt;&gt;&gt; hp.nodes.lahn_2.sequences.sim</span>
<span class="sd">        sim(2.0)</span>

<span class="sd">        The second example shows that the 1-dimensional inlet sequence</span>
<span class="sd">        |hstream_inlets.Q| points to the |Sim| sequence of node `lahn_1`:</span>

<span class="sd">        &gt;&gt;&gt; model.sequences.inlets.q</span>
<span class="sd">        q(0.0)</span>
<span class="sd">        &gt;&gt;&gt; hp.nodes.lahn_1.sequences.sim = 1.0</span>
<span class="sd">        &gt;&gt;&gt; model.sequences.inlets.q</span>
<span class="sd">        q(1.0)</span>
<span class="sd">        &gt;&gt;&gt; model.sequences.inlets.q(2.0)</span>
<span class="sd">        &gt;&gt;&gt; hp.nodes.lahn_1.sequences.sim</span>
<span class="sd">        sim(2.0)</span>

<span class="sd">        Direct querying the values of both link sequences shows that the</span>
<span class="sd">        value of the 0-dimensional outlet sequence is scalar, of course,</span>
<span class="sd">        and that the value of the 1-dimensional inlet sequence is one</span>
<span class="sd">        entry of a vector:</span>

<span class="sd">        &gt;&gt;&gt; model.sequences.outlets.q.value</span>
<span class="sd">        2.0</span>
<span class="sd">        &gt;&gt;&gt; model.sequences.inlets.q.values</span>
<span class="sd">        array([ 2.])</span>

<span class="sd">        Assigning bad data results in the standard error messages:</span>

<span class="sd">        &gt;&gt;&gt; model.sequences.outlets.q.value = 1.0, 2.0</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        ValueError: While trying to assign the value(s) (1.0, 2.0) to link \</span>
<span class="sd">sequence `q` of element `stream_lahn_1_lahn_2`, the following error occurred: \</span>
<span class="sd">2 values are assigned to the scalar variable `q` of element \</span>
<span class="sd">`stream_lahn_1_lahn_2`.</span>
<span class="sd">        &gt;&gt;&gt; model.sequences.inlets.q.values = 1.0, 2.0</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        ValueError: While trying to assign the value(s) (1.0, 2.0) to link \</span>
<span class="sd">sequence `q` of element `stream_lahn_1_lahn_2`, the following error occurred: \</span>
<span class="sd">While trying to convert the value(s) `(1.0, 2.0)` to a numpy ndarray with \</span>
<span class="sd">shape `(1,)` and type `float`, the following error occurred: could not \</span>
<span class="sd">broadcast input array from shape (2) into shape (1)</span>

<span class="sd">        In the example above, the 1-dimensional inlet sequence</span>
<span class="sd">        |hstream_inlets.Q| points to the value of a single |NodeSequence|</span>
<span class="sd">        value only.  We now prepare a |hbranch_v1| application model</span>
<span class="sd">        instance to show what happens when connecting a 1-dimensional</span>
<span class="sd">        |LinkSequence| object (|hbranch_outlets.Branched|) with three</span>
<span class="sd">        |NodeSequence| objects (see the documentation of application</span>
<span class="sd">        model |hbranch_v1| for more details):</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Element, Nodes, prepare_model</span>
<span class="sd">        &gt;&gt;&gt; model = prepare_model(&#39;hbranch_v1&#39;)</span>
<span class="sd">        &gt;&gt;&gt; nodes = Nodes(&#39;input1&#39;, &#39;input2&#39;, &#39;output1&#39;, &#39;output2&#39;, &#39;output3&#39;)</span>
<span class="sd">        &gt;&gt;&gt; branch = Element(&#39;branch&#39;,</span>
<span class="sd">        ...                  inlets=[&#39;input1&#39;, &#39;input2&#39;],</span>
<span class="sd">        ...                  outlets=[&#39;output1&#39;, &#39;output2&#39;, &#39;output3&#39;])</span>
<span class="sd">        &gt;&gt;&gt; model.parameters.control.xpoints(</span>
<span class="sd">        ...     0.0, 2.0, 4.0, 6.0)</span>
<span class="sd">        &gt;&gt;&gt; model.parameters.control.ypoints(</span>
<span class="sd">        ...     output1=[0.0, 1.0, 2.0, 3.0],</span>
<span class="sd">        ...     output2=[0.0, 1.0, 0.0, 0.0],</span>
<span class="sd">        ...     output3=[0.0, 0.0, 2.0, 6.0])</span>
<span class="sd">        &gt;&gt;&gt; branch.model = model</span>

<span class="sd">        Our third example demonstrates that each field of the values of a</span>
<span class="sd">        1-dimensional |LinkSequence| objects points to another |NodeSequence|</span>
<span class="sd">        object:</span>

<span class="sd">        &gt;&gt;&gt; nodes.output1.sequences.sim = 1.0</span>
<span class="sd">        &gt;&gt;&gt; nodes.output2.sequences.sim = 2.0</span>
<span class="sd">        &gt;&gt;&gt; nodes.output3.sequences.sim = 3.0</span>
<span class="sd">        &gt;&gt;&gt; model.sequences.outlets.branched</span>
<span class="sd">        branched(1.0, 2.0, 3.0)</span>
<span class="sd">        &gt;&gt;&gt; model.sequences.outlets.branched = 4.0, 5.0, 6.0</span>
<span class="sd">        &gt;&gt;&gt; nodes.output1.sequences.sim</span>
<span class="sd">        sim(4.0)</span>
<span class="sd">        &gt;&gt;&gt; nodes.output2.sequences.sim</span>
<span class="sd">        sim(5.0)</span>
<span class="sd">        &gt;&gt;&gt; nodes.output3.sequences.sim</span>
<span class="sd">        sim(6.0)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isready</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                    <span class="n">f</span><span class="s1">&#39;Proper connections are missing (which could &#39;</span>
                    <span class="n">f</span><span class="s1">&#39;result in segmentation faults when using it, &#39;</span>
                    <span class="n">f</span><span class="s1">&#39;so please be careful).&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="n">FastAccessModelSequence</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)[:]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;While trying to query the value(s) of link &#39;</span>
                <span class="n">f</span><span class="s1">&#39;sequence {objecttools.elementphrase(self)}&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__hydpy__set_value__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_setvalue</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="n">FastAccessModelSequence</span><span class="p">):</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)[:]</span> <span class="o">=</span> <span class="n">value_</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value_</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;While trying to assign the value(s) </span><span class="si">{value}</span><span class="s1"> to &#39;</span>
                <span class="n">f</span><span class="s1">&#39;link sequence {objecttools.elementphrase(self)}&#39;</span><span class="p">)</span>

    <span class="n">value</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">fget</span><span class="o">=</span><span class="n">__hydpy__get_value__</span><span class="p">,</span> <span class="n">fset</span><span class="o">=</span><span class="n">__hydpy__set_value__</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__hydpy__get_shape__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;A tuple containing the actual lengths of all dimensions.</span>

<span class="sd">        Property |LinkSequence.shape| of class |LinkSequence| works</span>
<span class="sd">        similarly as the general |Variable.shape| property of class</span>
<span class="sd">        |Variable| but you need to be extra careful due to the pointer</span>
<span class="sd">        mechanism underlying class |LinkSequence|.  Change the shape</span>
<span class="sd">        of a link sequence for good reasons only.  Please read the</span>
<span class="sd">        documentation on property |LinkSequence.value| first and then</span>
<span class="sd">        see the following examples which are, again, based on the</span>
<span class="sd">        `LahnH` example project and application model |hstream_v1|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_2</span>
<span class="sd">        &gt;&gt;&gt; hp, pub, TestIO = prepare_full_example_2()</span>
<span class="sd">        &gt;&gt;&gt; model = hp.elements.stream_lahn_1_lahn_2.model</span>

<span class="sd">        The default mechanisms of *HydPy* prepare both 0-dimensional</span>
<span class="sd">        and 1-dimensional link sequences with a proper shape (which,</span>
<span class="sd">        for inlet sequence |hstream_inlets.Q|, depends on the number</span>
<span class="sd">        of connected |Node| objects):</span>

<span class="sd">        &gt;&gt;&gt; model.sequences.outlets.q.shape</span>
<span class="sd">        ()</span>
<span class="sd">        &gt;&gt;&gt; model.sequences.inlets.q.shape</span>
<span class="sd">        (1,)</span>

<span class="sd">        Trying to set the only possible shape of 0-dimensional link</span>
<span class="sd">        sequences or to set any different shape results in the</span>
<span class="sd">        standard behaviour:</span>

<span class="sd">        &gt;&gt;&gt; model.sequences.outlets.q.shape = ()</span>
<span class="sd">        &gt;&gt;&gt; model.sequences.outlets.q.shape = (1,)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        ValueError: While trying to set the shape of link sequence`q` \</span>
<span class="sd">of element `stream_lahn_1_lahn_2`, the following error occurred: \</span>
<span class="sd">The shape information of 0-dimensional variables as `q` of element \</span>
<span class="sd">`stream_lahn_1_lahn_2` can only be `()`, but `(1,)` is given.</span>

<span class="sd">        Changing the shape of 1-dimensional link sequences is supported</span>
<span class="sd">        but results in losing the connection to the |NodeSequence| values</span>
<span class="sd">        of the respective nodes.  The following exception is raised to</span>
<span class="sd">        prevent segmentation faults until proper connections are available:</span>

<span class="sd">        &gt;&gt;&gt; model.sequences.inlets.q.shape = (2,)</span>
<span class="sd">        &gt;&gt;&gt; model.sequences.inlets.q.shape</span>
<span class="sd">        (2,)</span>
<span class="sd">        &gt;&gt;&gt; model.sequences.inlets.q.shape = 1</span>
<span class="sd">        &gt;&gt;&gt; model.sequences.inlets.q.shape</span>
<span class="sd">        (1,)</span>
<span class="sd">        &gt;&gt;&gt; model.sequences.inlets.q</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: While trying to query the value(s) of link sequence \</span>
<span class="sd">`q` of element `stream_lahn_1_lahn_2`, the following error occurred: \</span>
<span class="sd">The pointer of the actual `PPDouble` instance at index `0` requested, \</span>
<span class="sd">but not prepared yet via `set_pointer`.</span>

<span class="sd">        &gt;&gt;&gt; model.sequences.inlets.q(1.0)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: While trying to assign the value(s) 1.0 to link \</span>
<span class="sd">sequence `q` of element `stream_lahn_1_lahn_2`, the following error occurred: \</span>
<span class="sd">The pointer of the actual `PPDouble` instance at index `0` requested, \</span>
<span class="sd">but not prepared yet via `set_pointer`.</span>

<span class="sd">        Querying the shape of a link sequence should rarely result in</span>
<span class="sd">        errors.  However, if we enforce it by deleting the `fastaccess`</span>
<span class="sd">        attribute, we get an error message like the following:</span>

<span class="sd">        &gt;&gt;&gt; del model.sequences.inlets.q.fastaccess</span>
<span class="sd">        &gt;&gt;&gt; model.sequences.inlets.q.shape</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        AttributeError: While trying to query the shape of link sequence`q` \</span>
<span class="sd">of element `stream_lahn_1_lahn_2`, the following error occurred: \</span>
<span class="sd">&#39;Q&#39; object has no attribute &#39;fastaccess&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_fastaccessattribute</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;length_0&#39;</span><span class="p">),</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;While trying to query the shape of link sequence&#39;</span>
                <span class="n">f</span><span class="s1">&#39;{objecttools.elementphrase(self)}&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__hydpy__set_shape__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">shape</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_raise_wrongshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
                    <span class="n">shape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">shape</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="n">FastAccessModelSequence</span><span class="p">):</span>
                    <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">shape</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="o">.</span><span class="n">dealloc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="o">.</span><span class="n">alloc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="s1">&#39;len_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;While trying to set the shape of link sequence&#39;</span>
                <span class="n">f</span><span class="s1">&#39;{objecttools.elementphrase(self)}&#39;</span><span class="p">)</span>

    <span class="n">shape</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">fget</span><span class="o">=</span><span class="n">__hydpy__get_shape__</span><span class="p">,</span> <span class="n">fset</span><span class="o">=</span><span class="n">__hydpy__set_shape__</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isready</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{self.name}</span><span class="s1">(?)&#39;</span></div>


<div class="viewcode-block" id="InletSequence"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.InletSequence">[docs]</a><span class="k">class</span> <span class="nc">InletSequence</span><span class="p">(</span><span class="n">LinkSequence</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for inlet link sequences of |Model| objects.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="OutletSequence"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.OutletSequence">[docs]</a><span class="k">class</span> <span class="nc">OutletSequence</span><span class="p">(</span><span class="n">LinkSequence</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for outlet link sequences of |Model| objects.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="ReceiverSequence"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.ReceiverSequence">[docs]</a><span class="k">class</span> <span class="nc">ReceiverSequence</span><span class="p">(</span><span class="n">LinkSequence</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for receiver link sequences of |Model| objects.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="SenderSequence"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.SenderSequence">[docs]</a><span class="k">class</span> <span class="nc">SenderSequence</span><span class="p">(</span><span class="n">LinkSequence</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for sender link sequences of |Model| objects.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="NodeSequence"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.NodeSequence">[docs]</a><span class="k">class</span> <span class="nc">NodeSequence</span><span class="p">(</span><span class="n">IOSequence</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for all sequences to be handled by |Node| objects.&quot;&quot;&quot;</span>
    <span class="n">NDIM</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">NUMERIC</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">filetype_ext</span> <span class="o">=</span> <span class="n">_FileType</span><span class="p">()</span>
    <span class="n">dirpath_ext</span> <span class="o">=</span> <span class="n">_DirPathProperty</span><span class="p">()</span>
    <span class="n">aggregation_ext</span> <span class="o">=</span> <span class="n">_AggregationProperty</span><span class="p">()</span>
    <span class="n">overwrite_ext</span> <span class="o">=</span> <span class="n">_OverwriteProperty</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">descr_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Description of the |NodeSequence| object including the</span>
<span class="sd">        |Node.variable| to be represented.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Node</span>
<span class="sd">        &gt;&gt;&gt; Node(&#39;test_node_1&#39;, &#39;T&#39;).sequences.sim.descr_sequence</span>
<span class="sd">        &#39;sim_t&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{self.name}</span><span class="s1">_{self.subseqs.node.variable.lower()}&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">descr_device</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Description of the |Node| object the |NodeSequence| object</span>
<span class="sd">        belongs to.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Node</span>
<span class="sd">        &gt;&gt;&gt; Node(&#39;test_node_2&#39;).sequences.sim.descr_device</span>
<span class="sd">        &#39;test_node_2&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subseqs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="nf">_finalise_connections</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_finalise_connections</span><span class="p">()</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">pointerutils</span><span class="o">.</span><span class="n">Double</span><span class="p">(</span><span class="mf">0.</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__hydpy__get_value__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The actual sequence value.</span>

<span class="sd">        For framework users, property |NodeSequence.value| of class</span>
<span class="sd">        |NodeSequence| works as usual and explained in the documentation</span>
<span class="sd">        on property |Variable.shape| of class |Variable|.  However,</span>
<span class="sd">        framework developers should note that |NodeSequence| objects use</span>
<span class="sd">        |Double| objects for storing their values and making them</span>
<span class="sd">        accessible to |PDouble| and |PPDouble| objects as explained</span>
<span class="sd">        in detail in the documentation on class |LinkSequence|.</span>
<span class="sd">        For safety reasons, this mechanism is hidden for framework</span>
<span class="sd">        users via conversions to type |float|:</span>

<span class="sd">        .. testsetup::</span>

<span class="sd">            &gt;&gt;&gt; from hydpy import Node</span>
<span class="sd">            &gt;&gt;&gt; Node.clear_all()</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import Node</span>
<span class="sd">        &gt;&gt;&gt; sim = Node(&#39;node&#39;).sequences.sim</span>
<span class="sd">        &gt;&gt;&gt; sim(1.0)</span>
<span class="sd">        &gt;&gt;&gt; sim</span>
<span class="sd">        sim(1.0)</span>
<span class="sd">        &gt;&gt;&gt; sim.value</span>
<span class="sd">        1.0</span>
<span class="sd">        &gt;&gt;&gt; sim.fastaccess.sim</span>
<span class="sd">        Double(1.0)</span>

<span class="sd">        &gt;&gt;&gt; sim.value = 2.0</span>
<span class="sd">        &gt;&gt;&gt; sim</span>
<span class="sd">        sim(2.0)</span>

<span class="sd">        Node sequences return errors like the following in case they</span>
<span class="sd">        receive misspecified values or ill-configured:</span>

<span class="sd">        &gt;&gt;&gt; sim.value = 1.0, 2.0</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        TypeError: While trying to assign the value `(1.0, 2.0)` to \</span>
<span class="sd">sequence `sim` of node `node`, the following error occurred: \</span>
<span class="sd">float() argument must be a string or a number, not &#39;tuple&#39;</span>

<span class="sd">        &gt;&gt;&gt; del sim.fastaccess</span>
<span class="sd">        &gt;&gt;&gt; sim.value</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        AttributeError: While trying to query the value of sequence `sim` \</span>
<span class="sd">of node `node`, the following error occurred: \</span>
<span class="sd">&#39;Sim&#39; object has no attribute &#39;fastaccess&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;While trying to query the value of sequence &#39;</span>
                <span class="n">f</span><span class="s1">&#39;{objecttools.nodephrase(self)}&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__hydpy__set_value__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;While trying to assign the value `</span><span class="si">{value}</span><span class="s1">` to &#39;</span>
                <span class="n">f</span><span class="s1">&#39;sequence {objecttools.nodephrase(self)}&#39;</span><span class="p">)</span>

    <span class="n">value</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">fget</span><span class="o">=</span><span class="n">__hydpy__get_value__</span><span class="p">,</span> <span class="n">fset</span><span class="o">=</span><span class="n">__hydpy__set_value__</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">seriescomplete</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;True/False flag indicating whether simulated or observed data</span>
<span class="sd">        is fully available or not.</span>

<span class="sd">        We use the observation series of node `dill` of the `LahnH`</span>
<span class="sd">        project as an example:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_2</span>
<span class="sd">        &gt;&gt;&gt; hp, pub, TestIO = prepare_full_example_2()</span>
<span class="sd">        &gt;&gt;&gt; obs = hp.nodes.dill.sequences.obs</span>

<span class="sd">        When the sequence does not handle any time series data,</span>
<span class="sd">        |NodeSequence.seriescomplete| is |False|:</span>

<span class="sd">        &gt;&gt;&gt; obs.deactivate_ram()</span>
<span class="sd">        &gt;&gt;&gt; obs.series</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        AttributeError: Sequence `obs` of node `dill` is not requested \</span>
<span class="sd">to make any internal data available.</span>
<span class="sd">        &gt;&gt;&gt; obs.seriescomplete</span>
<span class="sd">        False</span>

<span class="sd">        As long as any time series data is missing,</span>
<span class="sd">        |NodeSequence.seriescomplete| is still |False|:</span>

<span class="sd">        &gt;&gt;&gt; obs.activate_ram()</span>
<span class="sd">        &gt;&gt;&gt; obs.series[:-1] = 1.0</span>
<span class="sd">        &gt;&gt;&gt; obs.series</span>
<span class="sd">        InfoArray([  1.,   1.,   1.,  nan])</span>
<span class="sd">        &gt;&gt;&gt; obs.seriescomplete</span>
<span class="sd">        False</span>

<span class="sd">        Only with all data being not |numpy.nan|,</span>
<span class="sd">        |NodeSequence.seriescomplete| is |True|:</span>

<span class="sd">        &gt;&gt;&gt; obs.series[-1] = 1.0</span>
<span class="sd">        &gt;&gt;&gt; obs.seriescomplete</span>
<span class="sd">        True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">memoryflag</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series</span><span class="p">))</span></div>


<div class="viewcode-block" id="Sim"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.Sim">[docs]</a><span class="k">class</span> <span class="nc">Sim</span><span class="p">(</span><span class="n">NodeSequence</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for handling those values of |Node| objects that are &quot;simulated&quot;,</span>
<span class="sd">    meaning calculated by hydrological models.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Sim.load_ext"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.Sim.load_ext">[docs]</a>    <span class="k">def</span> <span class="nf">load_ext</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Read time series data like method |IOSequence.load_ext| of class</span>
<span class="sd">        |IOSequence| but with special handling of missing data.</span>

<span class="sd">        The method&#39;s &quot;special handling&quot; is to convert errors to warnings.</span>
<span class="sd">        We explain the reasons in the documentation on method |Obs.load_ext|</span>
<span class="sd">        of class |Obs|, from which we borrow the following examples.</span>
<span class="sd">        The only differences are that method |Sim.load_ext| of class |Sim|</span>
<span class="sd">        does not disable property |IOSequence.memoryflag| and uses the option</span>
<span class="sd">        |Options.warnmissingsimfile| instead of |Options.warnmissingobsfile|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, pub, TestIO</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&#39;LahnH&#39;)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &#39;1996-01-01&#39;, &#39;1996-01-06&#39;, &#39;1d&#39;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     hp.prepare_models()</span>
<span class="sd">        ...     hp.prepare_simseries()</span>
<span class="sd">        &gt;&gt;&gt; sim = hp.nodes.dill.sequences.sim</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     sim.load_ext()    # doctest: +ELLIPSIS</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        UserWarning: While trying to load the external data of sequence \</span>
<span class="sd">`sim` of node `dill`, the following error occurred: [Errno 2] No such file \</span>
<span class="sd">or directory: &#39;...dill_sim_q.asc&#39;</span>
<span class="sd">        &gt;&gt;&gt; sim.series</span>
<span class="sd">        InfoArray([ nan,  nan,  nan,  nan,  nan])</span>

<span class="sd">        &gt;&gt;&gt; sim.series = 1.0</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     sim.save_ext()</span>
<span class="sd">        &gt;&gt;&gt; sim.series = 0.0</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     sim.load_ext()</span>
<span class="sd">        &gt;&gt;&gt; sim.series</span>
<span class="sd">        InfoArray([ 1.,  1.,  1.,  1.,  1.])</span>

<span class="sd">        &gt;&gt;&gt; import numpy</span>
<span class="sd">        &gt;&gt;&gt; sim.series[2] = numpy.nan</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     pub.sequencemanager.nodeoverwrite = True</span>
<span class="sd">        ...     sim.save_ext()</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     sim.load_ext()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        UserWarning: While trying to load the external data of sequence `sim` \</span>
<span class="sd">of node `dill`, the following error occurred: The series array of sequence \</span>
<span class="sd">`sim` of node `dill` contains 1 nan value.</span>
<span class="sd">        &gt;&gt;&gt; sim.series</span>
<span class="sd">        InfoArray([  1.,   1.,  nan,   1.,   1.])</span>

<span class="sd">        &gt;&gt;&gt; sim.series = 0.0</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     with pub.options.warnmissingsimfile(False):</span>
<span class="sd">        ...         sim.load_ext()</span>
<span class="sd">        &gt;&gt;&gt; sim.series</span>
<span class="sd">        InfoArray([  1.,   1.,  nan,   1.,   1.])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">load_ext</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">warnmissingsimfile</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span></div></div>


<div class="viewcode-block" id="Obs"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.Obs">[docs]</a><span class="k">class</span> <span class="nc">Obs</span><span class="p">(</span><span class="n">NodeSequence</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for handling those values of |Node| objects that are observed,</span>
<span class="sd">    meaning read from data files.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Obs.load_ext"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.Obs.load_ext">[docs]</a>    <span class="k">def</span> <span class="nf">load_ext</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Read time series data like method |IOSequence.load_ext| of class</span>
<span class="sd">        |IOSequence| but with special handling of missing data.</span>

<span class="sd">        When reading incomplete time series data, *HydPy* usually raises</span>
<span class="sd">        a |RuntimeError| to prevent from performing erroneous calculations.</span>
<span class="sd">        For instance, this makes sense for meteorological input data, being</span>
<span class="sd">        a strict requirement for hydrological simulations.  However, the</span>
<span class="sd">        same often does not hold for the time series of |Obs| sequences,</span>
<span class="sd">        e.g. representing measured discharge. Measured discharge is often</span>
<span class="sd">        handled as an optional input value, or even used for comparison</span>
<span class="sd">        purposes only.</span>

<span class="sd">        According to this reasoning, *HydPy* raises (at most) a |UserWarning|</span>
<span class="sd">        in case of missing or incomplete external time series data of |Obs|</span>
<span class="sd">        sequences.  The following examples show this based on the `LahnH`</span>
<span class="sd">        project, mainly focussing on the |Obs| sequence of node `dill`,</span>
<span class="sd">        which is ready for handling time series data at the end of the</span>
<span class="sd">        following steps:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.examples import prepare_full_example_1</span>
<span class="sd">        &gt;&gt;&gt; prepare_full_example_1()</span>
<span class="sd">        &gt;&gt;&gt; from hydpy import HydPy, pub, TestIO</span>
<span class="sd">        &gt;&gt;&gt; hp = HydPy(&#39;LahnH&#39;)</span>
<span class="sd">        &gt;&gt;&gt; pub.timegrids = &#39;1996-01-01&#39;, &#39;1996-01-06&#39;, &#39;1d&#39;</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.prepare_network()</span>
<span class="sd">        ...     hp.prepare_models()</span>
<span class="sd">        ...     hp.prepare_obsseries()</span>
<span class="sd">        &gt;&gt;&gt; obs = hp.nodes.dill.sequences.obs</span>
<span class="sd">        &gt;&gt;&gt; obs.ramflag</span>
<span class="sd">        True</span>

<span class="sd">        Trying to read non-existing data raises the following warning</span>
<span class="sd">        and disables the sequence&#39;s ability to handle time series data:</span>

<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     hp.load_obsseries()    # doctest: +ELLIPSIS</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        UserWarning: The `memory flag` of sequence `obs` of node `dill` had \</span>
<span class="sd">to be set to `False` due to the following problem: While trying to load the \</span>
<span class="sd">external data of sequence `obs` of node `dill`, the following error occurred: \</span>
<span class="sd">[Errno 2] No such file or directory: &#39;...dill_obs_q.asc&#39;</span>
<span class="sd">        &gt;&gt;&gt; obs.ramflag</span>
<span class="sd">        False</span>

<span class="sd">        After writing a complete external data file, everything works fine:</span>

<span class="sd">        &gt;&gt;&gt; obs.activate_ram()</span>
<span class="sd">        &gt;&gt;&gt; obs.series = 1.0</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     obs.save_ext()</span>
<span class="sd">        &gt;&gt;&gt; obs.series = 0.0</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     obs.load_ext()</span>
<span class="sd">        &gt;&gt;&gt; obs.series</span>
<span class="sd">        InfoArray([ 1.,  1.,  1.,  1.,  1.])</span>

<span class="sd">        Reading incomplete data also results in a warning message, but does</span>
<span class="sd">        not disable the |IOSequence.memoryflag|:</span>

<span class="sd">        &gt;&gt;&gt; import numpy</span>
<span class="sd">        &gt;&gt;&gt; obs.series[2] = numpy.nan</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     pub.sequencemanager.nodeoverwrite = True</span>
<span class="sd">        ...     obs.save_ext()</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     obs.load_ext()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        UserWarning: While trying to load the external data of sequence `obs` \</span>
<span class="sd">of node `dill`, the following error occurred: The series array of sequence \</span>
<span class="sd">`obs` of node `dill` contains 1 nan value.</span>
<span class="sd">        &gt;&gt;&gt; obs.memoryflag</span>
<span class="sd">        True</span>

<span class="sd">        Option |Options.warnmissingobsfile| allows disabling the warning</span>
<span class="sd">        messages without altering the functionalities described above:</span>

<span class="sd">        &gt;&gt;&gt; hp.prepare_obsseries()</span>
<span class="sd">        &gt;&gt;&gt; with TestIO():</span>
<span class="sd">        ...     with pub.options.warnmissingobsfile(False):</span>
<span class="sd">        ...         hp.load_obsseries()</span>
<span class="sd">        &gt;&gt;&gt; obs.series</span>
<span class="sd">        InfoArray([  1.,   1.,  nan,   1.,   1.])</span>
<span class="sd">        &gt;&gt;&gt; hp.nodes.lahn_1.sequences.obs.memoryflag</span>
<span class="sd">        False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">load_ext</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span><span class="s1">&#39;ramflag&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_fastaccessattribute</span><span class="p">(</span><span class="s1">&#39;diskflag&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">warnmissingobsfile</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="n">f</span><span class="s1">&#39;The `memory flag` of sequence &#39;</span>
                    <span class="n">f</span><span class="s1">&#39;{objecttools.nodephrase(self)} had to be set to `False` &#39;</span>
                    <span class="n">f</span><span class="s1">&#39;due to the following problem: {sys.exc_info()[1]}&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">warnmissingobsfile</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span></div></div>


<div class="viewcode-block" id="NodeSequences"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.NodeSequences">[docs]</a><span class="k">class</span> <span class="nc">NodeSequences</span><span class="p">(</span><span class="n">IOSequences</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for handling |Sim| and |Obs| sequence objects.</span>

<span class="sd">    Basically, |NodeSequences| works like the different |ModelSequences|</span>
<span class="sd">    subclasses used for handling |ModelSequence| objects.  The main</span>
<span class="sd">    differences are that |NodeSequences| objects always use a</span>
<span class="sd">    |FastAccessNodeSequence| object as their `fastaccess` attribute</span>
<span class="sd">    (both in pure Python and in Cython mode), and that they do not</span>
<span class="sd">    reference a |Sequences| object (which is only handled by |Element|</span>
<span class="sd">    objects but not by |Node| objects). Instead, they reference their</span>
<span class="sd">    master |Node| object via the attribute `node` directly:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import classname, Node</span>
<span class="sd">    &gt;&gt;&gt; node = Node(&#39;node&#39;)</span>
<span class="sd">    &gt;&gt;&gt; classname(node.sequences.fastaccess)</span>
<span class="sd">    &#39;FastAccessNodeSequence&#39;</span>
<span class="sd">    &gt;&gt;&gt; node.sequences.node</span>
<span class="sd">    Node(&quot;node&quot;, variable=&quot;Q&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">CLASSES</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">Sim</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">Obs</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Sim</span><span class="p">,</span> <span class="n">Obs</span><span class="p">)</span>

    <span class="n">node</span><span class="p">:</span> <span class="s1">&#39;devicetools.Node&#39;</span>
    <span class="n">sim</span><span class="p">:</span> <span class="n">Sim</span>
    <span class="n">obs</span><span class="p">:</span> <span class="n">Obs</span>
    <span class="n">fastaccess</span><span class="p">:</span> <span class="s1">&#39;FastAccessNodeSequence&#39;</span>
    <span class="n">_cls_fastaccess</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span>
        <span class="s1">&#39;typingtools.FastAccessModelSequenceProtocol&#39;</span><span class="p">]]</span>
    <span class="n">_cymodel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;typingtools.CyModelProtocol&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">master</span><span class="p">:</span> <span class="s1">&#39;devicetools.Node&#39;</span><span class="p">,</span>
            <span class="n">cls_fastaccess</span><span class="p">:</span>
            <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span>
                <span class="s1">&#39;typingtools.FastAccessModelSequenceProtocol&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">cymodel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;typingtools.CyModelProtocol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">master</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cls_fastaccess</span> <span class="o">=</span> <span class="n">cls_fastaccess</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cymodel</span> <span class="o">=</span> <span class="n">cymodel</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">master</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__hydpy__initialise_fastaccess__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span> <span class="o">=</span> <span class="n">FastAccessNodeSequence</span><span class="p">()</span>

<div class="viewcode-block" id="NodeSequences.load_data"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.NodeSequences.load_data">[docs]</a>    <span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Call methods |NodeSequences.load_simdata| and</span>
<span class="sd">        |NodeSequences.load_obsdata|.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_simdata</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_obsdata</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></div>

<div class="viewcode-block" id="NodeSequences.load_simdata"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.NodeSequences.load_simdata">[docs]</a>    <span class="k">def</span> <span class="nf">load_simdata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Call method |FastAccessNodeSequence.load_simdata| of the</span>
<span class="sd">        |FastAccessNodeSequence| object handled as attribute `fastaccess`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="o">.</span><span class="n">load_simdata</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></div>

<div class="viewcode-block" id="NodeSequences.load_obsdata"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.NodeSequences.load_obsdata">[docs]</a>    <span class="k">def</span> <span class="nf">load_obsdata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Call method |FastAccessNodeSequence.load_obsdata| of the</span>
<span class="sd">        |FastAccessNodeSequence| object handled as attribute `fastaccess`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="o">.</span><span class="n">load_obsdata</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></div>

<div class="viewcode-block" id="NodeSequences.save_data"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.NodeSequences.save_data">[docs]</a>    <span class="k">def</span> <span class="nf">save_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Call method |NodeSequences.save_data|.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_simdata</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></div>

<div class="viewcode-block" id="NodeSequences.save_simdata"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.NodeSequences.save_simdata">[docs]</a>    <span class="k">def</span> <span class="nf">save_simdata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Call method |FastAccessNodeSequence.save_simdata| of the</span>
<span class="sd">        |FastAccessNodeSequence| object handled as attribute `fastaccess`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="o">.</span><span class="n">save_simdata</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="LeftRightSequence"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.LeftRightSequence">[docs]</a><span class="k">class</span> <span class="nc">LeftRightSequence</span><span class="p">(</span><span class="n">FluxSequence</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for handling two values, a left one and a right one.</span>

<span class="sd">    The original purpose of class |LeftRightSequence| is to make the</span>
<span class="sd">    handling of river channel related properties with different values</span>
<span class="sd">    for both river banks a little more convenient.</span>

<span class="sd">    We use the foreland specific discharge sequence |lstream_fluxes.QV|</span>
<span class="sd">    of base model |lstream| to show that the left foreland  and the</span>
<span class="sd">    right foreland value can be changed and queried by properties</span>
<span class="sd">    |LeftRightSequence.left| and |LeftRightSequence.right|, respectively:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import prepare_model</span>
<span class="sd">    &gt;&gt;&gt; qv = prepare_model(&#39;lstream&#39;).sequences.fluxes.qv</span>
<span class="sd">    &gt;&gt;&gt; qv</span>
<span class="sd">    qv(nan, nan)</span>

<span class="sd">    &gt;&gt;&gt; qv.left = 1.0</span>
<span class="sd">    &gt;&gt;&gt; qv.right = 2.0</span>
<span class="sd">    &gt;&gt;&gt; qv</span>
<span class="sd">    qv(1.0, 2.0)</span>

<span class="sd">    &gt;&gt;&gt; qv(3.0, 4.0)</span>
<span class="sd">    &gt;&gt;&gt; qv.left</span>
<span class="sd">    3.0</span>
<span class="sd">    &gt;&gt;&gt; qv.right</span>
<span class="sd">    4.0</span>

<span class="sd">    &gt;&gt;&gt; qv.left = 1.0, 2.0</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: While trying to assign the &quot;left&quot; value `(1.0, 2.0)` to \</span>
<span class="sd">sequence `qv` of element `?`, the following error occurred: \</span>
<span class="sd">setting an array element with a sequence.</span>

<span class="sd">    &gt;&gt;&gt; qv.right = 1.0, 2.0</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: While trying to assign the &quot;right&quot; value `(1.0, 2.0)` to \</span>
<span class="sd">sequence `qv` of element `?`, the following error occurred: \</span>
<span class="sd">setting an array element with a sequence.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">NDIM</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_finalise_connections</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_finalise_connections</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">left</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The &quot;left&quot; value of the actual parameter.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@left</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;While trying to assign the &quot;left&quot; value `</span><span class="si">{value}</span><span class="s1">` &#39;</span>
                <span class="n">f</span><span class="s1">&#39;to sequence {objecttools.elementphrase(self)}&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">right</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The &quot;right&quot; value of the actual parameter.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@right</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">right</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># pylint: disable=unsupported-assignment-operation</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;While trying to assign the &quot;right&quot; value `</span><span class="si">{value}</span><span class="s1">` &#39;</span>
                <span class="n">f</span><span class="s1">&#39;to sequence {objecttools.elementphrase(self)}&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="FastAccessSequence"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.FastAccessSequence">[docs]</a><span class="k">class</span> <span class="nc">FastAccessSequence</span><span class="p">(</span><span class="n">variabletools</span><span class="o">.</span><span class="n">FastAccess</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for |FastAccessModelSequence| and |FastAccessNodeSequence|.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_get_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">suffix</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;_</span><span class="si">{name}</span><span class="s1">_</span><span class="si">{suffix}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;_</span><span class="si">{name}</span><span class="s1">_</span><span class="si">{suffix}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="FastAccessSequence.open_files"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.FastAccessSequence.open_files">[docs]</a>    <span class="k">def</span> <span class="nf">open_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open all files with an activated disk flag.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;diskflag&#39;</span><span class="p">):</span>
                <span class="n">file_</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="p">),</span> <span class="s1">&#39;rb+&#39;</span><span class="p">)</span>
                <span class="n">position</span> <span class="o">=</span> <span class="mi">8</span><span class="o">*</span><span class="n">idx</span>
                <span class="k">for</span> <span class="n">idim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;ndim&#39;</span><span class="p">)):</span>
                    <span class="n">position</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;length_</span><span class="si">{idim}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">file_</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="n">file_</span><span class="p">)</span></div>

<div class="viewcode-block" id="FastAccessSequence.close_files"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.FastAccessSequence.close_files">[docs]</a>    <span class="k">def</span> <span class="nf">close_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Close all files with an activated disk flag.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;diskflag&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Iterate over all sequence names.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">key</span></div>


<div class="viewcode-block" id="FastAccessModelSequence"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.FastAccessModelSequence">[docs]</a><span class="k">class</span> <span class="nc">FastAccessModelSequence</span><span class="p">(</span><span class="n">FastAccessSequence</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Provides fast access to the values of the sequences of a sequence</span>
<span class="sd">    subgroup and supports the handling of internal data series during</span>
<span class="sd">    simulations.</span>

<span class="sd">    The following details are of relevance for *HydPy* developers only.</span>

<span class="sd">    |sequencetools.FastAccessModelSequence| is applied in Python mode only.</span>
<span class="sd">    In Cython mode it is replaced by model-specific Cython extension</span>
<span class="sd">    classes, which are computationally more efficient.  For compatibility</span>
<span class="sd">    with these extension classes, |sequencetools.FastAccessModelSequence|</span>
<span class="sd">    objects work with dynamically set instance members.  Suppose there</span>
<span class="sd">    is a sequence named `seq1` which is 2-dimensional, then its associated</span>
<span class="sd">    attributes are:</span>

<span class="sd">      * seq1 (|numpy.ndarray|): The actual sequence values.</span>
<span class="sd">      * _seq1_ndim (|int|): Number of dimensions.</span>
<span class="sd">      * _seq1_length_0 (|int|): Length in the first dimension.</span>
<span class="sd">      * _seq1_length_1 (|int|): Length in the second dimension.</span>
<span class="sd">      * _seq1_ramflag (|bool|): Handle internal data in RAM?</span>
<span class="sd">      * _seq1_diskflag (|bool|): Handle internal data on disk?</span>
<span class="sd">      * _seq1_path (|str|): Path of the internal data file.</span>
<span class="sd">      * _seq1_file (|io.open|): Object handling the internal data file.</span>

<span class="sd">    Note that the respective |SubSequences| and |Sequence| objects</span>
<span class="sd">    initialise, change, and apply these dynamical attributes.  To</span>
<span class="sd">    handle them directly is error-prone and thus not recommended.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="FastAccessModelSequence.load_data"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.FastAccessModelSequence.load_data">[docs]</a>    <span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Load the internal data of all sequences with an activated</span>
<span class="sd">        |IOSequence.memoryflag|.</span>

<span class="sd">        Read from a file if the corresponding disk flag is activated; read</span>
<span class="sd">        from working memory if the corresponding ram flag is activated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">ndim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;ndim&#39;</span><span class="p">)</span>
            <span class="n">diskflag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;diskflag&#39;</span><span class="p">)</span>
            <span class="n">ramflag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;ramflag&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">diskflag</span><span class="p">:</span>
                <span class="n">length_tot</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">jdx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndim</span><span class="p">):</span>
                    <span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;length_</span><span class="si">{jdx}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">length_tot</span> <span class="o">*=</span> <span class="n">length</span>
                    <span class="n">shape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
                <span class="n">raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">length_tot</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">length_tot</span><span class="o">*</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">raw</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ndim</span><span class="p">:</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">ramflag</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;array&#39;</span><span class="p">)[</span><span class="n">idx</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">diskflag</span> <span class="ow">or</span> <span class="n">ramflag</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)[:]</span> <span class="o">=</span> <span class="n">values</span></div>

<div class="viewcode-block" id="FastAccessModelSequence.save_data"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.FastAccessModelSequence.save_data">[docs]</a>    <span class="k">def</span> <span class="nf">save_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Save the internal data of all sequences with an activated flag.</span>

<span class="sd">        Write to a file if the corresponding disk flag is activated; write</span>
<span class="sd">        to working memory if the corresponding ram flag is activated.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">actual</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;diskflag&#39;</span><span class="p">):</span>
                <span class="n">ndim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;ndim&#39;</span><span class="p">)</span>
                <span class="n">length_tot</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">jdx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndim</span><span class="p">):</span>
                    <span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;length_</span><span class="si">{jdx}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">length_tot</span> <span class="o">*=</span> <span class="n">length</span>
                <span class="k">if</span> <span class="n">ndim</span><span class="p">:</span>
                    <span class="n">raw</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">length_tot</span><span class="o">*</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">actual</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">raw</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;ramflag&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;array&#39;</span><span class="p">)[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">actual</span></div></div>


<div class="viewcode-block" id="FastAccessNodeSequence"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.FastAccessNodeSequence">[docs]</a><span class="k">class</span> <span class="nc">FastAccessNodeSequence</span><span class="p">(</span><span class="n">FastAccessSequence</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;|sequencetools.FastAccessModelSequence| like object specialised for</span>
<span class="sd">    |Node| objects.</span>

<span class="sd">    In contrast to |FastAccessModelSequence|, |FastAccessNodeSequence| only</span>
<span class="sd">    needs to handle a fixed number of sequences, |Sim| and |Obs|. It thus</span>
<span class="sd">    can define the related attributes explicitly.</span>

<span class="sd">    Note that there is no cythonized version of class |FastAccessNodeSequence|</span>
<span class="sd">    available so far.  Adding such a version could result in some speedups.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">sim</span><span class="p">:</span> <span class="n">pointerutils</span><span class="o">.</span><span class="n">Double</span>
    <span class="n">obs</span><span class="p">:</span> <span class="n">pointerutils</span><span class="o">.</span><span class="n">Double</span>
    <span class="n">_sim_array</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span>
    <span class="n">_obs_array</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span>
    <span class="n">_sim_ramflag</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">_obs_ramflag</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">_sim_diskflag</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">_obs_diskflag</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">_sim_file</span><span class="p">:</span> <span class="n">IO</span>
    <span class="n">_obs_file</span><span class="p">:</span> <span class="n">IO</span>

<div class="viewcode-block" id="FastAccessNodeSequence.load_simdata"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.FastAccessNodeSequence.load_simdata">[docs]</a>    <span class="k">def</span> <span class="nf">load_simdata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Load the next sim sequence value (of the given index).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_ramflag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_array</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_diskflag</span><span class="p">:</span>
            <span class="n">raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">raw</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="FastAccessNodeSequence.save_simdata"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.FastAccessNodeSequence.save_simdata">[docs]</a>    <span class="k">def</span> <span class="nf">save_simdata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Save the last sim sequence value (of the given index).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_ramflag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sim_array</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_diskflag</span><span class="p">:</span>
            <span class="n">raw</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sim_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span></div>

<div class="viewcode-block" id="FastAccessNodeSequence.load_obsdata"><a class="viewcode-back" href="../../../sequencetools.html#hydpy.core.sequencetools.FastAccessNodeSequence.load_obsdata">[docs]</a>    <span class="k">def</span> <span class="nf">load_obsdata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Load the next obs sequence value (of the given index).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_ramflag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_array</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_diskflag</span><span class="p">:</span>
            <span class="n">raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">raw</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/HydPy_Logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../../../index.html">Table of Contents</a></h3>
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../framework.html">Framework Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modelcollection.html">Model Collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples.html">Example Projects</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HydPy 4.0a11 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, HydPy Developers.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.1.
    </div>
  </body>
</html>